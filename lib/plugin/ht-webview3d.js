!function(f){"use strict";var v=f.ht,G=v.Default,Z=G.getInternal(),H=Z.superCall,f=v.graph3d.Graph3dView,m=f.prototype.validateImpl;function d(t){var J,a,b,U,F,N,z=[],W=0,y=G.createDiv(!0),m=t.getView(),s=(m.insertBefore(y,t.getCanvas()),(J=v.Default.createDiv()).style.WebkitTransformStyle="preserve-3d",J.style.MozTransformStyle="preserve-3d",J.style.transformStyle="preserve-3d",y.appendChild(J),[{event:"mousedown",style:"none"},{event:"mouseup",style:"auto"},{event:"touchstart",style:"none"},{event:"touchend",style:"auto"}].forEach(function(f){var H=f.style;Z.addEventListener(m,f.event,function(){t.isDragProtectForWebView()&&(y.style.pointerEvents=H)})}),new v.Math.Vector3(0,0,1)),p=new v.Math.Vector3(0,0,1),n=new v.Math.Quaternion,c=new v.Math.Matrix4,V=v.Math.randomFloat,B=new v.Math.Euler,i=new v.Math.Matrix4,O=new v.Math.Matrix4,g=new v.Math.Matrix4,o=(this.updateWebView=function(){if(t.getWidth()&&t.getHeight()){var f,H,m,Z,d,S=t.getCanvas(),c=+S.style.width.slice(0,-2),S=+S.style.height.slice(0,-2),c=(z[0]===c&&z[1]===S||(z[0]=c,z[1]=S,y.style.width=c+"px",y.style.height=S+"px",J.style.width=c+"px",J.style.height=S+"px"),t._projectMatrix[5]*z[1]/2),o=(c!==a&&(a=c,y.style.WebkitPerspective=a+"px",y.style.MozPerspective=a+"px",y.style.perspective=a+"px"),[]),G=(t.dm().each(function(f){f.isWebView&&o.push(f)}),f=o.length,100),e=t.getCamera();do{for(d=!0,X=0;X<=f;X++)if((X===f?e:o[X]).getQuaternion(n),H&&n.premultiply(H),m=p.set(1,0,0).applyQuaternion(n).dot(s),Z=p.set(0,1,0).applyQuaternion(n).dot(s),Math.abs(Math.abs(m)-1)<.1||Math.abs(Math.abs(Z)-1)<.1){d=!1,N?(H=N,N=null):(H=H||new v.Math.Quaternion,B.set(0,V(-Math.PI,Math.PI),0),H.setFromEuler(B));break}}while(G--&&!d);for(var j,S=t._viewMatrix,S=(H&&(S=i.makeRotationFromQuaternion(H.inverse()).premultiply(S).toArray(),i.makeRotationFromQuaternion(H.inverse())),O.fromArray(S),O.setPosition(p.set(0,0,-100)),g.copy(O).invert().multiply(S),S=O.toArray(),(F="translateZ("+a+"px)"+("matrix3d("+L((c=S)[0])+","+L(-c[1])+","+L(c[2])+","+L(c[3])+","+L(c[4])+","+L(-c[5])+","+L(c[6])+","+L(c[7])+","+L(c[8])+","+L(-c[9])+","+L(c[10])+","+L(c[11])+","+L(c[12])+","+L(-c[13])+","+L(c[14])+","+L(c[15])+")"))+"translate("+z[0]/2+"px,"+z[1]/2+"px)"),k=(b===S||U||(J.style.WebkitTransform=S,J.style.MozTransform=S,J.style.transform=S,b=S),W++,o.forEach(function(f){A(f,H?i:null,g)}),J.children),R=[],X=0,_=k.length;X<_;X++)(j=k[X])._isHtWebView&&j._renderCookie!==W&&R.push(j);R.length&&R.forEach(function(f){J.removeChild(f)}),N=H}},new Array(16)),A=function(f,H,m){var Z,d,S=f.getAttach();S&&((d=t.isVisible(f))&&S.parentNode!==J?J.appendChild(S):!d&&S.parentNode&&G.removeHTML(S),d&&(S._renderCookie=W,d=f.getFinalScale3d(),(Z=f._prefrenceSize)&&Z[0]?Z[1]||(Z[1]=Z[0]/d[0]*d[1]):Z=[d[0],d[1]],S.style.width=Z[0]+"px",S.style.height=Z[1]+"px",d=1/Z[0],Z=1/Z[1],f=f.mat,o[0]=f[0]*d,o[1]=f[1]*d,o[2]=f[2]*d,o[3]=f[3]*d,o[4]=f[4]*Z,o[5]=f[5]*Z,o[6]=f[6]*Z,o[7]=f[7]*Z,o[8]=+f[8],o[9]=+f[9],o[10]=+f[10],o[11]=+f[11],o[12]=f[12],o[13]=f[13],o[14]=f[14],o[15]=f[15],H&&(o=c.multiplyMatrices(H,o).toArray()),d=function(f,H){f="matrix3d("+L(f[0])+","+L(f[1])+","+L(f[2])+","+L(f[3])+","+L(-f[4])+","+L(-f[5])+","+L(-f[6])+","+L(-f[7])+","+L(f[8])+","+L(f[9])+","+L(f[10])+","+L(f[11])+","+L(f[12])+","+L(f[13])+","+L(f[14])+","+L(f[15])+")";return"translate(-50%,-50%)"+(H||"")+f}(o=m?c.multiplyMatrices(m,o).toArray():o,U?"translate("+z[0]/2+"px,"+z[1]/2+"px)"+F:""),S.$a2!==d&&(S.$a2=d,S.style.WebkitTransform=d,S.style.MozTransform=d,S.style.transform=d)))}}function L(f){return Math.abs(f)<1e-10?0:f}f.prototype.validateImpl=function(){m.call(this),(this._webViewRenderer||(this._webViewRenderer=new d(this))).updateWebView()},f.prototype.isDragProtectForWebView=function(){return this._dragProtectForWebView},f.prototype.setDragProtectForWebView=function(f){this._dragProtectForWebView=f},v.Default.setShader("htWebView3d",["attribute vec3 aPosition;","uniform mat4 uModelViewMatrix ;","uniform mat4 uProjectMatrix;","void main(void) {","gl_Position = uProjectMatrix * uModelViewMatrix  * vec4(aPosition, 1.0);","}","// FS","void main(void) {","gl_FragColor = vec4(0.0);","}"].join("\n"));var S={type:"htWebView3d"},c=v.WebView3d=function(){H(c,this),this.s({shape3d:"billboard","shape3d.reverse.flip":!0})};G.def("ht.WebView3d",v.Node,{ms_ac:["attach"],isWebView:!0,attachDOM:function(f,H,m){if(!f)return this.detachDOM();"string"==typeof f&&((Z=document.createElement("iframe")).src=f,f=Z);var Z=f.style;Z.position="absolute",Z.outline=0,Z.margin=0,f._isHtWebView=!0,this.setAttach(f),this._prefrenceSize=[H,m],this.s("shape3d.material",S)},detachDOM:function(){this.setAttach(null),this.s("shape3d.material",void 0)}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);