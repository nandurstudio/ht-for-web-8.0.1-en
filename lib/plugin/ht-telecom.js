!function(k){"use strict";var R=ht.AlarmSeverity=function(k,S,N,v,H){this.value=k,this.name=S,this.nickName=N,this.color=v,this.displayName=H},S=(ht.Default.def("ht.AlarmSeverity",k,{toString:function(){return this.displayName||this.name}}),R.severities=new ht.List,R._vm={},R._nm={},R._cp=function(k,S){var N;return k&&S?0<(N=k.value-S.value)?1:N<0?-1:0:k&&!S?1:!k&&S?-1:0},R.each=function(k,S){R.severities.each(k,S)},R.getSortFunction=function(){return R._cp},R.setSortFunction=function(k){R._cp=k,R.severities.sort(k)},R.add=function(k,S,N,v,H){N=new R(k,S,N,v,H);return R._vm[k]=N,R._nm[S]=N,R.severities.add(N),R.severities.sort(R._cp),N},R.remove=function(k){var S=R._nm[k];return S&&(delete R._nm[k],delete R._vm[S.value],R.severities.remove(S)),S},R.CRITICAL=R.add(500,"Critical","C","#FF0000"),R.MAJOR=R.add(400,"Major","M","#FFA000"),R.MINOR=R.add(300,"Minor","m","#FFFF00"),R.WARNING=R.add(200,"Warning","W","#00FFFF"),R.INDETERMINATE=R.add(100,"Indeterminate","N","#C800FF"),R.CLEARED=R.add(0,"Cleared","R","#00FF00"),R.isClearedAlarmSeverity=function(k){return!!k&&0===k.value},R.getByName=function(k){return R._nm[k]},R.getByValue=function(k){return R._vm[k]},R.clear=function(){R.severities.clear(),R._vm={},R._nm={}},R.compare=function(k,S){return R._cp(k,S)},ht.AlarmState=function(k){this._d=k,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0}),N=(ht.Default.def("ht.AlarmState",k,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var k,S=null;for(k in this._am)k=R.getByName(k),R.isClearedAlarmSeverity(k)||0!==this.getAcknowledgedAlarmCount(k)&&(S=S&&0<R.compare(S,k)?S:k);this._haa=S},_c2:function(){var k,S=null;for(k in this._nm)k=R.getByName(k),R.isClearedAlarmSeverity(k)||0!==this.getNewAlarmCount(k)&&(S=S&&0<R.compare(S,k)?S:k);this._hna=S},_c3:function(){if(this._hna){for(var k in this._nm)if(k=R.getByName(k),!R.isClearedAlarmSeverity(k)&&0!==this.getNewAlarmCount(k)&&0<R.compare(this._hna,k))return void(this._hls=!0);this._hls=!1}else this._hls=!1},_c4:function(){var k=this._haa,S=this._hna,N=this._ps;this._hoa=k,0<R.compare(S,this._hoa)&&(this._hoa=S),0<R.compare(N,this._hoa)&&(this._hoa=N)},_c5:function(){var k=this._haa,S=this._hna;this._hta=k,0<R.compare(S,this._hta)&&(this._hta=S)},increaseAcknowledgedAlarm:function(k,S){var N;0!==S&&(N=this._am[k.name]||0,this._am[k.name]=N+=S=S||1,this._f())},increaseNewAlarm:function(k,S){var N;0!==S&&(N=this._nm[k.name]||0,this._nm[k.name]=N+=S=S||1,this._f())},decreaseAcknowledgedAlarm:function(k,S){if(0!==S){var N=this._am[k.name]||0;if((N-=S=S||1)<0)throw"Alarm count can not be negative";this._am[k.name]=N,this._f()}},decreaseNewAlarm:function(k,S){if(0!==S){var N=this._nm[k.name]||0;if((N-=S=S||1)<0)throw"Alarm count can not be negative";this._nm[k.name]=N,this._f()}},acknowledgeAlarm:function(k){this.decreaseNewAlarm(k,1),this.increaseAcknowledgedAlarm(k,1)},acknowledgeAllAlarms:function(k){if(k){var S=this.getNewAlarmCount(k);this.decreaseNewAlarm(k,S),this.increaseAcknowledgedAlarm(k,S)}else for(var N in this._nm)this.acknowledgeAllAlarms(R.getByName(N))},_c6:function(){for(var k in this._aac=0,this._am)k=R.getByName(k),this._aac+=this.getAcknowledgedAlarmCount(k)},getAcknowledgedAlarmCount:function(k){return k?this._am[k.name]||0:this._aac},getAlarmCount:function(k){return this.getAcknowledgedAlarmCount(k)+this.getNewAlarmCount(k)},_c7:function(){for(var k in this._nac=0,this._nm)this._nac+=this.getNewAlarmCount(R.getByName(k))},getNewAlarmCount:function(k){return k?this._nm[k.name]||0:this._nac},setNewAlarmCount:function(k,S){this._nm[k.name]=S,this._f()},removeAllNewAlarms:function(k){k?delete this._nm[k]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(k,S){this._am[k.name]=S,this._f()},removeAllAcknowledgedAlarms:function(k){k?delete this._am[k.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(k){var S;this._ep||(k=null),this._ps!==k&&(S=this._ps,this._ps=k,this._f(),this._d.fp("propagateSeverity",S,k))},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(k){var S=this._ep;this._ep=k,this._d.fp("enablePropagation",S,k)&&!k&&this.setPropagateSeverity(null)}}),ht.AlarmStatePropagator=function(k){this._dataModel=k,this._enable=!1,this._isPropagating=!1}),k=(ht.Default.def("ht.AlarmStatePropagator",k,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(k){this._enable!==k&&(this._enable=k,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(k){this.propagate(k)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(k){k.data&&this.propagate(k.data)},handleDataPropertyChange:function(k){var S;"alarmState"===k.property||"enablePropagation"===k.property?this.propagate(k.data):"parent"===k.property&&((S=k.oldValue)&&this.propagate(S),this.propagate(k.data))},propagate:function(k){k&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(k),this._isPropagating=!1)},propagateToTop:function(k){for(this.propagateToParent(null,k);k&&k.getParent();)this.propagateToParent(k,k.getParent()),k=k.getParent()},propagateToParent:function(k,S){var N=null;S.getChildren().each(function(k){k=k.getAlarmState().getHighestOverallAlarmSeverity();0<R.compare(k,N)&&(N=k)}),S.getAlarmState().setPropagateSeverity(N)}}),ht.AlarmStateStatistics=function(k){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(k)},ht.Default.def("ht.AlarmStateStatistics",k,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(k){var S=this._dataModel;S!==k&&(S&&(S.umd(this.handleDataPropertyChange,this),S.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=k,this.reset(),k.md(this.handleDataPropertyChange,this),k.mm(this.handleDataModelChange,this),this.fp("dataModel",S,k))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(k){"alarmState"===k.property&&(this.increase(k.data),this.fireAlarmStateChange())},handleDataModelChange:function(k){"add"===k.kind?(this.increase(k.data),this.fireAlarmStateChange()):"remove"===k.kind?(this.decrease(k.data),this.fireAlarmStateChange()):"clear"===k.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,R.each(function(k){k=this.getSumInfo(k);this.sumAcked+=k.ackedCount,this.sumNew+=k.newCount,this.sumTotal+=k.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(k){return k?this.getSumInfo(k).newCount:this.sumNew},getAcknowledgedAlarmCount:function(k){return k?this.getSumInfo(k).ackedCount:this.sumAcked},getTotalAlarmCount:function(k){return k?this.getSumInfo(k).totalCount:this.sumTotal},getSumInfo:function(k){var S=this.severtiyMap[k.name];return S||(this.severtiyMap[k.name]=S={newCount:0,ackedCount:0,totalCount:0}),S},decrease:function(k){var N=this.dataMap[k.getId()];N&&(delete this.dataMap[k.getId()],R.each(function(k){var S=N[k.name],k=this.getSumInfo(k);k.newCount=k.newCount-S.newCount,k.ackedCount=k.ackedCount-S.ackedCount,k.totalCount=k.totalCount-S.totalCount},this))},increase:function(k){var N,v;this.decrease(k),this._filterFunc&&!this._filterFunc(k)||(N={},v=k.getAlarmState(),this.dataMap[k.getId()]=N,R.each(function(k){var S={},k=(S.newCount=v.getNewAlarmCount(k),S.ackedCount=v.getAcknowledgedAlarmCount(k),S.totalCount=v.getAlarmCount(k),N[k.name]=S,this.getSumInfo(k));k.newCount=k.newCount+S.newCount,k.ackedCount=k.ackedCount+S.ackedCount,k.totalCount=k.totalCount+S.totalCount},this))},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(k){var S=this._filterFunc;this._filterFunc=k,this.reset(),this.fp("filterFunc",S,k)},getFilterFunc:function(){return this._filterFunc}}),ht.Data.prototype),k=(k.getAlarmState=function(){return this._alarmState||(this._alarmState=new S(this))},(k=ht.DataModel.prototype).isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},k.setEnableAlarmStatePropagator=function(k){k!=this.isEnableAlarmStatePropagator()&&(k?(this._alarmStatePropagator=new N(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},(k=ht.graph.GraphView.prototype).getNote2=function(k){var S=k.getAlarmState().getHighestNewAlarmSeverity();return S?(S=k.getAlarmState().getNewAlarmCount(S)+S.nickName,k.getAlarmState().hasLessSevereNewAlarms()&&(S+="+"),S):k.s("note2")},k.getNote2Background=function(k){var S=k.getAlarmState().getHighestNewAlarmSeverity();return S?S.color:k.s("note2.background")},k.getBodyColor=function(k){var S=k.getAlarmState().getHighestNativeAlarmSeverity();return S?S.color:k.s("body.color")},k.getBorderColor=function(k){var S=k.getAlarmState().getPropagateSeverity();return S?S.color:k.s("border.color")},(k=ht.widget.TreeView.prototype).getBorderColor=function(k){var S=k.getAlarmState().getPropagateSeverity();return S?S.color:k.s("border.color")},k.getIcon=function(k){return k.getIcon()?"__alarmIcon__":null},(k=ht.widget.TreeTableView.prototype).getBorderColor=function(k){var S=k.getAlarmState().getPropagateSeverity();return S?S.color:k.s("border.color")},k.getIcon=function(k){return k.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(k){return k.getIcon()}},color:{func:function(k){var S=k.getAlarmState().getHighestNativeAlarmSeverity();return S?S.color:k.s("body.color")}},rect:[0,0,16,16]}]}),ht.Style);k["note2.expanded"]=!0,k["note2.color"]="#000"}(("undefined"==typeof global&&"undefined"==typeof self&&"undefined"==typeof window&&(0,eval)("this"),Object));