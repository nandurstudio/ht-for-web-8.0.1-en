!function(N){"use strict";function H(N,J){for(var Q=[],x=N.length,m=0;m<x;m++)for(var p=N[m],P=(p=p._as?p._as:p)[0],Z=1;Z<p.length;Z++)Q.push([P,p[Z]]),P=p[Z];for(var e=[],m=0;m<Q.length;m++){var L=$(Q[m][0],Q[m][1],J);e.push(L)}return{distance:e,segments:Q}}function m(N,J,Q){if(N){for(var x,N=H(N,J),m=N.distance,p=N.segments,P=1/0,Z=null,e=0,L=m.length;e<L;e++){var g=m[e];g.z<P&&(x=e,P=g.z,Z=g)}if(Z.z<(Q=null==Q?.1:Q)){for(var A=0,a=0;a<=x;a++)A+=O.getDistance(p[a][0],a<x?p[a][1]:Z);return A}}}function x(N,J){var Q,x;if(N)return N=H(N,J).distance,Q=1/0,x=null,N.forEach(function(N){N.z<Q&&(Q=N.z,x=N)}),x}function p(N,J,Q){if(!N)return Q;if(0===J)return M=N[0][0],a=N[0][1],Q+Math.atan2(a.y-M.y,a.x-M.x);if(100===J)return M=(N=N[N.length-1])[N.length-2],a=N[N.length-1],Q+Math.atan2(a.y-M.y,a.x-M.x);for(var x=0,m=[],p=N.length,P=0;P<p;P++){var Z=N[P],Z=Y(Z);x+=Z,m.push(Z)}for(var e=x*J/100,L=G(e,m),g=0,A=0;A<L;A++)g+=m[A];for(var a=I(N[L],e-=g),H=N[L],O=0,l=0,T=0;T<H.length-1;T++){var i=H[T],F=H[T+1],j=F.x-i.x,F=F.y-i.y;if(e<(O+=Math.sqrt(j*j+F*F))){l=T;break}}var M=H[l];return Q+Math.atan2(a.y-M.y,a.x-M.x)}function Q(N){var J=0;if(N)if(Array.isArray(N[0]))for(var Q=N.length,x=0;x<Q;x++){var m=N[x];J+=Y(m)}else J=Y(N);return J}function P(N){var J=N._data,Q=A(N);if(Q){J.s("flow.reverse")&&(Q.reverse(),Q.forEach(function(N){N.reverse()}));for(var x,m,p=0,P=[],Z=Q.length,e=0;e<Z;e++){var L=Q[e],L=Y(L);p+=L,P.push(L)}J[y]=P,J[V]=p,J[c]=Q,J instanceof g.Edge&&(x=(m=O.unionPoint(Q)).x+m.width/2,m=m.y+m.height/2,J.$10e={x:x,y:m}),o(N,!0)}}function X(N){var J,Q=N.data,x=this.dm();Q&&"add"===N.kind&&(J=x.$3e)&&Q.s(Z)&&J.indexOf(Q)<0&&J.push(Q),"clear"===N.kind&&(x.$3e=[])}function S(N){var J=N.property,Q=N.data,N=N.newValue,x=this.dm().$3e;if(x&&"s:flow"===J)if(N)x.indexOf(Q)<0&&x.push(Q);else for(var m=x.length,p=0;p<m;p++)if(x[p]===Q){x.splice(p,1);break}}function b(i){var N,F=this,j=F._data,M=j[V],u=j[y],Y=j[c],J=j.s(t),Q=F[n],x=j.s(U),m=j.s(s),p=j.s(W),P=j.s(R),Z=j.s(C),B=j.s(w),e=(Z-P)/(p-1),L=(x-m)/(p-1),X=j.getRotation?j.getRotation():0,S=j.getPosition?j.p():j.$10e,b=[],v=[];if(Q!=T){if(1===p)b.push(x);else if(2===p)b.push(x),b.push(m);else{if(!(2<p))return;b.push(x);for(var g=p-2;0<g;g--)b.push(m+L*g);b.push(m)}if(1===p)v.push(Z);else if(2===p)v.push(Z),v.push(P);else{if(!(2<p))return;v.push(Z);for(g=p-2;0<g;g--)v.push(P+e*g);v.push(P)}var k=0,A=0;b.forEach(function(N){k<p-1&&(A+=j.getFlowElementSpace(N)),k++}),N=(M-J*(A+=(x+m)/2)+A)/J,i.save();for(g=0;g<J;g++){var r=Q,$=0,a=F._overCount,h=0;j.s("flow.autoreverse")&&a&&J-(g+1)<a||(r-=g*(N+A),k=0,b.forEach(function(N){var J,Q,x,m=r-$;if(0<=m&&m<M){for(var p=G(m,u),P=h=0;P<p;P++)h+=u[P];m-=h;var Z=I(Y[p],m),e=X;if(B){for(var L=Y[p],g=0,A=0,a=0;a<L.length-1;a++){var H=L[a],O=L[a+1],l=O.x-H.x,O=O.y-H.y;if(m<(g+=Math.sqrt(l*l+O*O))){A=a;break}}var T=L[A];e+=Math.atan2(Z.y-T.y,Z.x-T.x)}X&&(T=S,J=Z.x-S.x,Q=Z.y-S.y,x=X,q.set(J,Q).rotateAround(null,x),Z=T?{x:T.x+q.x,y:T.y+q.y}:{x:q.x,y:q.y}),F.$5e(i,Z,N,v[k],e)}$+=j.getFlowElementSpace(b[k]),k++}))}i.restore()}}function v(){var N,J=this,Q=J._data,x=Q.s(U),m=!1,p=T;return J._6I||(m=!0),p=(Q instanceof g.Edge?K:_).call(J),Q.s(Z)&&m&&(N=Q.s(C),0<(x=Q.s(u)&&x<N?N:x)&&O.grow(p,Math.ceil(x/2)),P(J)),!Q.s(Z)&&m&&(Q[y]=Q[V]=Q[c]=J[n]=T),p}function k(N){this.__flowBatchGroup={}}function r(J){var N=this.__flowBatchGroup;if(N){for(var Q in J.save(),N)J.fillStyle=Q,J.beginPath(),N[Q].forEach(function(N){J.moveTo(N[0],N[1]),J.arc(N[0],N[1],N[2],0,2*Math.PI,!0)}),J.fill();J.restore()}}var g=N.ht,O=g.Default,l=O.getInternal(),N=l.ui(),T=null,y="__segmentLengths",V="__lineTotalLength",c="__linePoints",n="__distance0",t="flow.count",F="flow.step",U="flow.element.max",W="flow.element.count",s="flow.element.min",J="flow.element.space",w="flow.element.autorotate",i="flow.element.background",C="flow.element.shadow.max",R="flow.element.shadow.min",j="flow.element.shadow.begincolor",M="flow.element.shadow.endcolor",u="flow.element.shadow.visible",Z="flow",e=g.Math.Vector2,q=new e,e=(new e,new e,g.List,g.Default._edgeProtectMethod),A=e.getStraightLinePoints,$=function(N,J,Q){var x=N.x,m=N.y,p=J.x,P=J.y,Z=Q.x,Q=Q.y,p=p-x,P=P-m,e=Math.sqrt(p*p+P*P),L=p/e,e=P/e,g=(-x+Z)*L+(-m+Q)*e,x={x:x+g*L,y:m+g*e};return x.x>=Math.min(N.x,J.x)&&x.x<=Math.max(N.x,J.x)&&x.y>=Math.min(N.y,J.y)&&x.y<=Math.max(N.y,J.y)||(x.x=(Math.abs(x.x-N.x)<Math.abs(x.x-J.x)?N:J).x,x.y=(Math.abs(x.y-N.y)<Math.abs(x.y-J.y)?N:J).y),p=Z-x.x,P=Q-x.y,x.z=Math.sqrt(p*p+P*P),x},Y=e.calculateLineLength,G=e.calcSegmentIndexByDistance,I=e.calculatePointAlongLine,h=e.getPercentPosition,o=function(N,J){var Q,x=N._data,m=x[V],p=x.s(t),P=x.s(F),Z=x[y],e=x.s(U),L=x.s(s),g=x.s(W),A=(e-L)/(g-1),a=[];if(Z){if(1===g)a.push(e);else if(2===g)a.push(e),a.push(L);else{if(!(2<g))return;a.push(e);for(var H=g-2;0<H;H--)a.push(L+A*H);a.push(L)}var O=0,l=0,T=(a.forEach(function(N){O<g-1&&(l+=x.getFlowElementSpace(N)),O++}),Q=(m-p*(l+=(e+L)/2)+l)/p,N[n]);for(null==T&&(T=0),J||(T+=P);m+l<T;){var i=N._overCount;i?i++:i=1,p<=i&&(i=null),N._overCount=i,!x.s("flow.autoreverse")||i?T-=Q+l:(T=0,x.s("flow.reverse",!x.s("flow.reverse")))}N[n]=T}},e="prototype",L=g.graph.GraphView[e],D=g.Data[e],f=N.DataUI[e],a=N.ShapeUI[e],N=N.EdgeUI[e],e=g.DataModel[e],B=g.Style,z=(B[U]==T&&(B[U]=7),B[s]==T&&(B[s]=0),B[t]==T&&(B[t]=1),B[F]==T&&(B[F]=3),B[W]==T&&(B[W]=10),B[J]==T&&(B[J]=3.5),B[w]==T&&(B[w]=!1),B[i]==T&&(B[i]="rgba(255, 255, 114, 0.4)"),B[j]==T&&(B[j]="rgba(255, 255, 0, 0.3)"),B[M]==T&&(B[M]="rgba(255, 255, 0, 0)"),B[u]==T&&(B[u]=1),B[C]==T&&(B[C]=22),B[R]==T&&(B[R]=4),L.calculatePointLength=function(N,J,Q){N=this.getDataUI(N),N=A(N);return m(N,J,Q)},O.calculatePointLength=function(N,J,Q,x){N=A(T,N,J);return m(N,Q,x)},O.calculateClosestPointOnLine=$,L.calculateClosestPoint=function(N,J){N=this.getDataUI(N),N=A(N);return x(N,J)},O.calculateClosestPoint=function(N,J,Q){N=A(T,N,J);return x(N,Q)},L.getPercentAngle=function(N,J){var Q=this.getDataUI(N),Q=A(Q);N.getRotation&&N.getRotation();return p(Q,J,N.getRotation?N.getRotation():0)},O.getPercentAngle=function(N,J,Q){N=A(T,N,J);return p(N,Q,0)},L.calculateLength=function(N){N=this.getDataUI(N),N=A(N);return Q(N)},O.calculateLength=function(N,J){N=A(T,N,J);return Q(N)},L.getPercentPosition=function(N,J){N=this.getDataUI(N),N=A(N);return h(N,J)},O.getPercentPositionOnPoints=function(N,J,Q){N=A(T,N,J);return h(N,Q)},L.setDataModel),E=(L.setDataModel=function(N){var J,Q=this,x=Q._dataModel;x!==N&&(x&&(x.umm(X,Q),x.umd(S,Q),x.$3e=[]),N.mm(X,Q),N.md(S,Q),J=N.$3e=[],N.each(function(N){N.s(Z)&&J.indexOf(N)<0&&J.push(N)}),z.call(Q,N))},D.getFlowElementSpace=function(N){return this.s(J)},N.drawBody),d=(N.drawBody=function(N){E.call(this,N);var J=this._data,Q=this.gv;J.s(Z)&&Q.$7e!=T&&b.call(this,N)},a.drawBody),K=(a.drawBody=function(N){d.call(this,N);var J=this._data,Q=this.gv;J.s(Z)&&Q.$7e!=T&&b.call(this,N)},N._79o),_=a._79o,NB=(a._79o=v,N._79o=v,f.$5e=function(N,J,Q,x,m){var p,P=this._data,Z=this.gv,e=P.s(i),L=P.s(j),g=P.s(M),A=P.s(u),a=Z.$8e,H=P.s("flow.element.image");a==T&&(a=Z.$8e={}),N.beginPath(),H!=T?(H=O.getImage(H),p=Q/2,N.translate(J.x,J.y),N.rotate(m),N.translate(-J.x,-J.y),O.drawImage(N,H,J.x-p,J.y-p,Q,Q,P),N.translate(J.x,J.y),N.rotate(-m),N.translate(-J.x,-J.y)):Z.__flowBatch?(H=(H=Z.__flowBatchGroup)||(Z.__flowBatchGroup={}),m=[J.x,J.y,Q/2],H[e]?H[e].push(m):H[e]=[m]):(N.fillStyle=e,N.arc(J.x,J.y,Q/2,0,2*Math.PI,!0),N.fill()),A&&((H=a[Z="22_"+L+"_"+g])==T&&(m=document.createElement("canvas"),l.setCanvas(m,22,22),e=m.getContext("2d"),l.translateAndScale(e,0,0,1),e.beginPath(),(Q=e.createRadialGradient(11,11,0,11,11,11)).addColorStop(0,L),Q.addColorStop(1,g),e.fillStyle=Q,e.arc(11,11,11,0,2*Math.PI,!0),e.fill(),H=a[Z]=m),O.drawImage(N,H,J.x-(p=x/2),J.y-p,x,x,P))},L.$9e=function(){var J=this,N=J.dm().$3e;J._24I;N.forEach(function(N){J._24I[N._id]=N}),J.iv()},e.prepareRemove);e.prepareRemove=function(N){NB.call(this,N);var J=N._dataModel.$3e;if(J)for(var Q=J.length,x=0;x<Q;x++)if(J[x]===N){J.splice(x,1);break}},L.setFlowInterval=function(N){var J=this,Q=J.$11e;J.$11e=N,J.fp("flowInterval",Q,N),J.$7e!=T&&(clearInterval(J.$7e),delete J.$7e,J.enableFlow(N))},L.getFlowInterval=function(){return this.$11e},L.enableFlow=function(N){var J=this,Q=J.dm(),x=Q.$3e;J.$7e==T&&(x.forEach(function(N){N=J.getDataUI(N);P(N)}),J.$7e=setInterval(function(){Q.$3e.forEach(function(N){o(J.getDataUI(N))}),J.$9e()},N||J.$11e||50))},L.disableFlow=function(){clearInterval(this.$7e),delete this.$7e,this.dm().$3e&&this.$9e()};L.setFlowBatch=function(N){var J=this;!!J.__flowBatch!=!!N&&((J.__flowBatch=N)?(J.addBottomPainter(k),J.addTopPainter(r)):(J.removeBottomPainter(k),J.removeTopPainter(r)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);