!function(K,t){"use strict";function Y(K){return K*K}var k="ht.layout.",W=K.ht||module.parent.exports.ht,v=W.List,$=W.DataModel,p=W.Node,m=W.Edge,R=W.Group,K=Math,J=K.sqrt,i=K.random,g=K.max,N=K.min,s=(W.Default.getInternal().addMSMap({ms_force:function(K,t){K._interval=50,K._stepCount=10,K._motionLimit=.01,K._edgeRepulsion=.65,K._nodeRepulsion=.65,K._damper=1,K._maxMotion=0,K._motionRatio=0,K.init=function(K){var t=this;K instanceof $?t.dm=K:t.gv=K,t._nodeMap={},t._nodes=new v,t._edges=new v},K.start=function(){var K,k=this,t=k.gv;k._timer||((K=k.cdm=t?t.dm():k.dm).mm(k.handleDataModelChange,k),K.md(k.handleDataPropertyChange,k),t&&t.mp(k.handleGV,k),K.each(function(K){var t;k.isVisible(K)&&k.isLayoutable(K)&&K instanceof p&&(k instanceof s?(t=K.p3(),K.p3([t[0]+i(),t[1]+i(),t[2]+i()])):(t=K.p(),K.p(t.x+i(),t.y+i())))}),k._timer=setInterval(function(){k.relax()},k._interval),k._damper=1)},K.stop=function(){var K=this;K._timer&&(K.cdm.umm(K.handleDataModelChange,K),K.cdm.umd(K.handleDataPropertyChange,K),K.gv&&K.gv.ump(K.handleGV,K),clearInterval(K._timer),delete K._timer,delete K.cdm)},K.handleGV=function(K){var t,k=this;"dataModel"===K.property&&(t=K.oldValue,K=K.newValue,t&&(t.umm(k.handleDataModelChange,k),t.umd(k.handleDataPropertyChange,k)),(this.cdm=K).mm(k.handleDataModelChange,k),K.md(k.handleDataPropertyChange,k))},K.relax=function(){var t=this;if(!(t._damper<.1&&t._maxMotion<t._motionLimit)){this.cdm.each(function(K){t.isVisible(K)&&(K instanceof m?t.addEdge(K):K instanceof p&&t.addNode(K))});for(var K,k,v=0,Y=t._edges,W=t._nodes,$=W.size();v<t._stepCount;v++){for(Y.each(t.relaxEdge,t),K=0;K<$;K++)for(k=0;k<$;k++)t.relaxNode(W.get(K),W.get(k));t.moveNode()}t._isAdjusting=1,W.each(function(K){K.fix||(K.p?K.v.p3(K.p):K.v.p(K.x,K.y))}),delete t._isAdjusting,t._nodeMap={},W.clear(),Y.clear(),t.onRelaxed()}},K.onRelaxed=function(){},K.isRunning=function(){return!!this._timer},K.isVisible=function(K){return!1!==K.s("layoutable")&&(!this.gv||this.gv.isVisible(K))},K.isLayoutable=function(K){if(!1===K.s("layoutable"))return!1;if(K instanceof R)return!1;var t=this;return t.gv?t.gv.isMovable(K)&&!t.gv.isSelected(K):!(t.cdm||t.dm).sm().co(K)},K.getNodeRepulsion=function(){return this._nodeRepulsion},K.setNodeRepulsion=function(K){this._nodeRepulsion=K,this._damper=1},K.getEdgeRepulsion=function(){return this._edgeRepulsion},K.setEdgeRepulsion=function(K){this._edgeRepulsion=K,this._damper=1},K.getStepCount=function(){return this._stepCount},K.setStepCount=function(K){this._stepCount=K,this._damper=1},K.getInterval=function(){return this._interval},K.setInterval=function(K){var t=this;t._interval!==K&&(t._interval=K,t._timer&&(clearInterval(t._timer),t._timer=setInterval(function(){t.relax()},K)))},K.handleDataPropertyChange=function(K){!this._isAdjusting&&this.isVisible(K.data)&&(this._damper=1)},K.handleDataModelChange=function(K){this._damper=1},K.damp=function(){var K=this._maxMotion,t=this._damper;this._motionRatio<=.001&&((K<.2||1<K&&t<.9)&&.01<t?this._damper-=.01:K<.4&&.003<t?this._damper-=.003:1e-4<t&&(this._damper-=1e-4)),K<this._motionLimit&&(this._damper=0)}}}),W.layout.ForceLayout=function(K){this.init(K)},W.Default.def(k+"ForceLayout",t,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(K){this._limitBounds=K,this._damper=1},getNodeSize:function(K){var t=this.gv;return t&&t.getDataUIBounds?t.getDataUIBounds(K):K.getRect()},addNode:function(K){var t=this,k=t._nodeMap[K._id];if(k)return k;var v=K.p(),v=(k={v:K,x:v.x,y:v.y,dx:0,dy:0,fix:!t.isLayoutable(K),s:t.getNodeSize(K)}).s,v=J(Y(v.width)+Y(v.height))*t._nodeRepulsion;return k.r=v<1?100:v,t._nodeMap[K._id]=k,t._nodes.add(k),k},addEdge:function(K){var t,k,v;K._40I&&K._41I&&(t={s:k=this.addNode(K._40I),t:K=this.addNode(K._41I)},K=K.s,k=k.s,v=K.width+k.width,K=K.height+k.height,t.length=J(v*v+K*K)*this._edgeRepulsion,t.length<=0&&(t.length=100),this._edges.add(t))},relaxEdge:function(K){var t=K.t,k=K.s,v=t.x-k.x,Y=t.y-k.y,W=J(v*v+Y*Y),K=100*K.length,v=.25*v/K*W,Y=.25*Y/K*W;t.dx=t.dx-v,t.dy=t.dy-Y,k.dx=k.dx+v,k.dy=k.dy+Y},relaxNode:function(K,t){var k,v,Y,W,$;K!==t&&((v=k=0)==(W=($=K.x-t.x)*$+(Y=K.y-t.y)*Y)?(k=i(),v=i()):W<36e4&&(k=$/W,v=Y/W),v*=$=K.r*t.r/400,K.dx+=k*=$,K.dy+=v,t.dx-=k,t.dy-=v)},moveNode:function(){var v=this,Y=v._limitBounds,K=v._maxMotion,W=0,$=v._damper;v._nodes.each(function(K){var t,k;K.fix||(k=K.dx*$,t=K.dy*$,K.dx=k/2,K.dy=t/2,W=g(J(k*k+t*t),W),K.x+=g(-40,N(40,k)),K.y+=g(-40,N(40,t)),Y&&(K.x<Y.x&&(K.x=Y.x,v.adjust(1,0)),K.y<Y.y&&(K.y=Y.y,v.adjust(0,1)),k=K.s,K.x+k.width>Y.x+Y.width&&(K.x=Y.x+Y.width-k.width,v.adjust(-1,0)),K.y+k.height>Y.y+Y.height&&(K.y=Y.y+Y.height-k.height,v.adjust(0,-1))))}),v._maxMotion=W,v._motionRatio=0<W?K/W-1:0,v.damp()},adjust:function(t,k){var v=this._limitBounds;this._nodes.each(function(K){0<t?(!v||K.x+K.s.width+t<v.x+v.width)&&(K.x+=t):(!v||K.x+t>v.x)&&(K.x+=t),0<k?(!v||K.y+K.s.height+k<v.y+v.height)&&(K.y+=k):(!v||K.y+k>v.y)&&(K.y+=k)})}}),W.layout.Force3dLayout=function(K){this.init(K)});W.Default.def(k+"Force3dLayout",t,{ms_force:1,getNodeSize3d:function(K){return K.s3()},addNode:function(K){var t=this,k=t._nodeMap[K._id];if(k)return k;var v=(k={v:K,p:K.p3(),d:[0,0,0],fix:!t.isLayoutable(K),s:t.getNodeSize3d(K)}).s,v=W.Default.getDistance(v)*t._nodeRepulsion;return k.r=v<1?100:v,t._nodeMap[K._id]=k,t._nodes.add(k),k},addEdge:function(K){var t,k;K._40I&&K._41I&&(t={s:k=this.addNode(K._40I),t:K=this.addNode(K._41I)},K=K.s,k=k.s,t.length=J(Y(K[0]+k[0])+Y(K[1]+k[1])+Y(K[2]+k[2]))*this._edgeRepulsion,t.length<=0&&(t.length=100),this._edges.add(t))},relaxEdge:function(K){var t=K.t.p,k=K.s.p,v=K.t.d,Y=K.s.d,W=t[0]-k[0],$=t[1]-k[1],t=t[2]-k[2],k=J(W*W+$*$+t*t),K=100*K.length,W=.25*W/K*k,$=.25*$/K*k,t=.25*t/K*k;v[0]-=W,v[1]-=$,v[2]-=t,Y[0]+=W,Y[1]+=$,Y[2]+=t},relaxNode:function(K,t){var k,v,Y,W,$,p,m;K!==t&&(m=K.p,W=t.p,(Y=v=k=0)==(W=($=m[0]-W[0])*$+(p=m[1]-W[1])*p+(m=m[2]-W[2])*m)?(k=i(),v=i(),Y=i()):W<216e6&&(k=$/W,v=p/W,Y=m/W),$=K.r*t.r/400,p=K.d,m=t.d,v*=$,Y*=$,p[0]+=k*=$,p[1]+=v,p[2]+=Y,m[0]-=k,m[1]-=v,m[2]-=Y)},moveNode:function(){var K=this,t=K._maxMotion,W=0,$=K._damper;K._nodes.each(function(K){var t,k,v,Y;K.fix||(t=K.p,k=(K=K.d)[0]*$,v=K[1]*$,Y=K[2]*$,K[0]=k/2,K[1]=v/2,K[2]=Y/2,W=g(J(k*k+v*v+Y*Y),W),t[0]+=g(-40,N(40,k)),t[1]+=g(-40,N(40,v)),t[2]+=g(-40,N(40,Y)))}),K._maxMotion=W,K._motionRatio=0<W?t/W-1:0,K.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);