!function(c,v,Q){"use strict";var w,n,S=c.ht;S.Astar={};function A(c){for(var v=c,n=[];v.parent;)n.unshift(v),v=v.parent;return n}function _(c,v){v=v||{},this.nodes=[],this.diagonal=!!v.diagonal,this.grid=[];for(var n=0;n<c.length;n++){this.grid[n]=[];for(var Q=0,_=c[n];Q<_.length;Q++){var F=new Z(n,Q,_[Q]);this.grid[n][Q]=F,this.nodes.push(F)}}this.$13x()}function Z(c,v,n){this.x=c,this.y=v,this.weight=n}function B(c){this.content=[],this.scoreFunction=c}w={search:function(c,v,n,Q){c.$6x();var _=(_=(Q=Q||{}).heuristic)||(c.diagonal?w.$4x.diagonal:w.$4x.manhattan),F=Q.closest||!1,Z=Q.punish,I=new B(function(c){return c.f}),U=v;for(v.h=_(v,n),c.$7x(v),I.push(v);0<I.size();){var k=I.pop();if(k===n)return A(k);k.closed=!0;for(var e=c.neighbors(k),O=0,X=e.length;O<X;++O){var K,r,b=e[O];b.closed||b.$9x()||(K=k.g+b.getCost(k,Z),(!(r=b.visited)||K<b.g)&&(b.visited=!0,b.parent=k,b.h=b.h||_(b,n),b.g=K,b.f=b.g+b.h,c.$7x(b),F&&(b.h<U.h||b.h===U.h&&b.g<U.g)&&(U=b),r?I.$10x(b):I.push(b)))}}return F?A(U):[]},$4x:{manhattan:function(c,v){return Math.abs(v.x-c.x)+Math.abs(v.y-c.y)},diagonal:function(c,v){var n=Math.sqrt(2),Q=Math.abs(v.x-c.x),v=Math.abs(v.y-c.y);return+(Q+v)+(n-2)*Math.min(Q,v)}},$5x:function(c){c.f=0,c.g=0,c.h=0,c.visited=!1,c.closed=!1,c.parent=null}},_.prototype.$13x=function(){this.dirtyNodes=[];for(var c=0;c<this.nodes.length;c++)w.$5x(this.nodes[c])},_.prototype.$6x=function(){for(var c=0;c<this.dirtyNodes.length;c++)w.$5x(this.dirtyNodes[c]);this.dirtyNodes=[]},_.prototype.$7x=function(c){this.dirtyNodes.push(c)},_.prototype.neighbors=function(c){var v=[],n=c.x,c=c.y,Q=this.grid;return Q[n-1]&&Q[n-1][c]&&v.push(Q[n-1][c]),Q[n+1]&&Q[n+1][c]&&v.push(Q[n+1][c]),Q[n]&&Q[n][c-1]&&v.push(Q[n][c-1]),Q[n]&&Q[n][c+1]&&v.push(Q[n][c+1]),this.diagonal&&(Q[n-1]&&Q[n-1][c-1]&&v.push(Q[n-1][c-1]),Q[n+1]&&Q[n+1][c-1]&&v.push(Q[n+1][c-1]),Q[n-1]&&Q[n-1][c+1]&&v.push(Q[n-1][c+1]),Q[n+1]&&Q[n+1][c+1]&&v.push(Q[n+1][c+1])),v},_.prototype.toString=function(){for(var c=[],v=this.grid,n=0;n<v.length;n++){for(var Q=[],_=v[n],F=0;F<_.length;F++)Q.push(_[F].weight);c.push(Q.join(" "))}return c.join("\n")},Z.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},Z.prototype.getCost=function(c,v){var n=c&&c.x!=this.x&&c.y!=this.y?1.41421*this.weight:this.weight;if(v){if(!c)return n;var Q=c.parent;if(!Q)return n;if(1e-5<Math.abs(Q.x+this.x-2*c.x))return n+v;if(1e-5<Math.abs(Q.y+this.y-2*c.y))return n+v}return n},Z.prototype.$9x=function(){return 0===this.weight},B.prototype={push:function(c){this.content.push(c),this.$11x(this.content.length-1)},pop:function(){var c=this.content[0],v=this.content.pop();return 0<this.content.length&&(this.content[0]=v,this.$12x(0)),c},remove:function(c){var v=this.content.indexOf(c),n=this.content.pop();v!==this.content.length-1&&(this.content[v]=n,this.scoreFunction(n)<this.scoreFunction(c)?this.$11x(v):this.$12x(v))},size:function(){return this.content.length},$10x:function(c){this.$11x(this.content.indexOf(c))},$11x:function(c){for(var v=this.content[c];0<c;){var n=(c+1>>1)-1,Q=this.content[n];if(!(this.scoreFunction(v)<this.scoreFunction(Q)))break;this.content[n]=v,this.content[c]=Q,c=n}},$12x:function(c){for(var v=this.content.length,n=this.content[c],Q=this.scoreFunction(n);;){var _,F=c+1<<1,Z=F-1,I=null;if(Z<v&&(_=this.content[Z],(_=this.scoreFunction(_))<Q&&(I=Z)),F<v&&(Z=this.content[F],this.scoreFunction(Z)<(null===I?Q:_)&&(I=F)),null===I)break;this.content[c]=this.content[I],this.content[I]=n,c=I}}},n={astar:w,Graph:_},c.AStar=n.astar,c.AStar.Graph=n.Graph;c=S.Astar.Finder=function(c,v){this.gv=c,this.$13x(v),this.refreshMap()};(c.prototype={}).constructor=c,v.defineProperties(c.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(c){this.gv._astarDebugInfo=c}}}),c.prototype.$13x=function(c){var v=this.$14x={},n=(c=c||{}).gridSize||10;v.gridSizeX=c.gridSizeX||n,v.gridSizeY=c.gridSizeY||n,v.rect=c.rect,v.filter=c.filter,v.extendBlocks=c.extendBlocks||3,v.fastOverlap=c.fastOverlap===Q||c.fastOverlap,v.nodeRectExtend=c.nodeRectExtend||0,v.diagonal=c.diagonal===Q||c.diagonal,v.turnPunish=c.turnPunish===Q?.1:c.turnPunish,v.simplify=c.simplify===Q||c.simplify,v.toGridCenter=c.toGridCenter!==Q&&c.toGridCenter,v.closest=c.closest===Q||c.closest},c.prototype.refreshMap=function(){var c=this,v=c.$14x,n=v.gridSizeX,Q=v.gridSizeY,_=v.extendBlocks,v=(v.rect?Z=v.rect:(Z=c.$15x(),S.Default.grow(Z,n*_,Q*_)),S.Default.grow(Z,n,Q),Math.floor(Z.x/n)*n),_=Math.floor(Z.y/Q)*Q,F=Math.ceil(Z.width/n),Z=Math.ceil(Z.height/Q);c.$16x={x:v,y:_,w:F*n,h:Z*Q,gridX:n,gridY:Q,xLen:F,yLen:Z},c.$17x(),c.$21x()},c.prototype.$15x=function(){var v,n=this.gv;if(n instanceof S.graph.GraphView)return n.getContentRect();var Q=S.Default.unionRect;return n.dm().each(function(c){n.isVisible(c)&&c.getRect&&(v=Q(v,c.getRect()))}),v},c.prototype.$17x=function(){for(var c,v,n=this,Q=n.$16x,_=Q.xLen,F=Q.yLen,Z=new Array(_),I=0;I<_;I++)for(Z[I]=c=new Array(F),v=F;v--;)c[v]=1;var U=n.$14x.filter;for(n.gv.dm().each(function(c){U&&!1===U(c)||n._debugInfo&&(c===n._debugInfo.grid||c==n._debugInfo.path)||n.$1cw(Z,c)}),I=0;I<_;I++)Z[I][0]=1,Z[I][F-1]=1;for(v=0;v<F;v++)Z[0][v]=1,Z[_-1][v]=1;n.grid=Z;Q=new AStar.Graph(Z,{diagonal:n.$14x.diagonal});n.graph=Q},c.prototype.$18x=function(c,v,n,Q,_,F,Z,I){var U=this.$19x,k=U(n-c,_-Z,Q-v,F-I);if(k<=1e-6&&-1e-6<=k)return!1;Z=U(_-c,_-Z,F-v,F-I)/k;if(Z<0||1<Z)return!1;I=U(n-c,_-c,Q-v,F-v)/k;return!(I<0||1<I)},c.prototype.$19x=function(c,v,n,Q){return c*Q-v*n},c.prototype.$1aw=function(c,v,n,Q){for(var _=[-(v[1]-c[1]),v[0]-c[0]],F=0<=_[0]*(n[0]-c[0])+_[1]*(n[1]-c[1]),Z=0,I=Q.length;Z<I;Z+=2)if(0<=_[0]*(Q[Z]-c[0])+_[1]*(Q[Z+1]-c[1])==F)return!1;return!0},c.prototype.$1bw=function(c,v){for(var n,Q,_=0,F=c.length;_<F;_+=2)if(this.$1aw([c[_],c[_+1]],[c[n=_===F-2?0:_+2],c[n+1]],[c[Q=n===F-2?0:n+2],c[Q+1]],v))return!1;for(_=0,F=v.length;_<F;_+=2)if(this.$1aw([v[_],v[_+1]],[v[n=_===F-2?0:_+2],v[n+1]],[v[Q=n===F-2?0:n+2],v[Q+1]],c))return!1;return!0},c.prototype.$1cw=function(c,v){if(v.getRect){var n,Q,_,F,Z,I,U,k,e,O,X,K,r=this,b=v.getRect(),w=(S.Default.grow(b,r.$14x.nodeRectExtend),r.$1dw({x:b.x,y:b.y})),b=r.$1dw({x:b.x+b.width,y:b.y+b.height}),A=r.$14x.fastOverlap;for(A||(v=v.getCorners(),k=[],v.forEach(function(c){k.push(c.x,c.y)}),I=r.$14x.gridSizeX/2,U=r.$14x.gridSizeY/2),v=Math.max(0,w.x),Q=Math.min(b.x,c.length-1),F=Math.max(0,w.y),Z=Math.min(b.y,c.length?c[0].length-1:-1),n=v;n<=Q;n++)for(_=F;_<=Z;_++)A?c[n][_]=0:(e=(K=r.$1ew({x:n,y:_})).x-I,O=K.x+I,X=K.y-U,K=K.y+U,r.$1bw(k,[e,X,e,K,O,K,O,X])&&(c[n][_]=0))}},c.prototype.$1dw=function(c,v){var n=this.$16x,Q=(c.x-n.x)/n.gridX,c=(c.y-n.y)/n.gridY;return!1!==v&&(Q=Math.round(Q),c=Math.round(c)),{x:Q,y:c}},c.prototype.$1ew=function(c){var v=this.$16x;return{x:c.x*v.gridX+v.x,y:c.y*v.gridY+v.y}},c.prototype.$1fw=function(c){var v=this.$16x,n=v.xLen,v=v.yLen;if(0<=c.x&&c.x<n&&0<=c.y&&c.y<v)return c;c={x:c.x,y:c.y};return c.x<0?c.x=0:c.x>=n&&(c.x=n-1),c.y<0?c.y=0:c.y>=v&&(c.y=v-1),c},c.prototype.findPath=function(c,v){var n,Q,_=this,F=_.$1dw(c),Z=_.$1dw(v),I=_.$1fw(F),U=_.$1fw(Z);if(I!==F&&U!==Z){var k=_.$16x,e=k.x-k.gridX/2,O=k.y-k.gridY/2,X=e+k.gridX*k.xLen,k=O+k.gridY*k.yLen;if(!(_.$18x(c.x,c.y,v.x,v.y,e,O,X,O)||_.$18x(c.x,c.y,v.x,v.y,X,O,X,k)||_.$18x(c.x,c.y,v.x,v.y,X,k,e,k)||_.$18x(c.x,c.y,v.x,v.y,e,k,e,O)))return[c,v]}I!==F&&(n=!0,F=I),U!==Z&&(Q=!0,Z=U);var X=_.graph.grid[F.x][F.y],k=_.graph.grid[Z.x][Z.y],K=AStar.search(_.graph,X,k,{closest:_.$14x.closest,punish:_.$14x.turnPunish});if(!K||!K.length)return null;var r=[];r.push(c),n&&r.push(_.$1ew(K[0]));for(var b=1,w=K.length;b<w-1;b++)r.push(_.$1ew(K[b]));return Q?(r.push(_.$1ew(K[w-1])),r.push(v)):(e=K[w-1],Z.x!==e.x||Z.y!==e.y||_.$14x.toGridCenter?r.push(_.$1ew(e)):r.push(v)),_.$14x.simplify&&(r=_.simplifyPath(r)),_.$20x=r,_.$21x(),r},c.prototype.debugOn=function(c){this.debugFlag=!0,this.debugSettings=c||{},this.$21x()},c.prototype.simplifyPath=function(c){var v=c.length;if(v<=2)return c;for(var n,Q=[c[0],c[1]],_=Q[0],F=Q[1],Z=2;Z<v;Z++)n=c[Z],Math.abs((F.x-_.x)*(n.y-_.y)-(F.y-_.y)*(n.x-_.x))<1e-5?F=Q[Q.length-1]=n:(_=F,Q.push(F=n));return Q},c.prototype.$21x=function(){var c=this;if(c.$22x(),this.debugFlag){var v=c.grid;if(v){var n=c.gv;if(!1!==c.debugSettings.$16x){for(var Q,_,F,Z,I=[],U=[],k=c.$14x.gridSizeX/2,e=c.$14x.gridSizeY/2,O=v.length,X=O?v[0].length:0,K=1;K<O-1;K++)for(var r=1;r<X-1;r++)v[K][r]||(Q=(Z=c.$1ew({x:K,y:r})).x-k,_=Z.x+k,F=Z.y-e,Z=Z.y+e,I.push({x:Q,y:F},{x:Q,y:Z},{x:_,y:Z},{x:_,y:F}),U.push(1,2,2,2,5));var b=new S.Shape;b.s("shape.border.color","rgba(50, 50, 50, 0.2)"),b.s("shape.border.width",1),b.s("shape.background","rgba(200, 50, 100, 0.2)"),b.s("2d.editable",!1),b.s("2d.selectable",!1),b.setPoints(I),b.setSegments(U),c._debugInfo={grid:b},n.dm().add(b)}!1!==c.debugSettings.path&&(I=new S.Shape,c.$20x&&(I.setPoints(c.$20x),I.s("shape.border.color","red"),I.s("shape.border.width",1),I.s("2d.editable",!1),I.s("2d.selectable",!1),I.s("shape.background",null),c._debugInfo||(c._debugInfo={}),c._debugInfo.path=I,n.dm().add(I)))}}},c.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},c.prototype.$22x=function(){var c,v,n,Q=this;Q._debugInfo&&(c=Q._debugInfo.grid,v=Q._debugInfo.path,n=Q.gv,c&&n.dm().remove(c),v&&n.dm().remove(v),Q._debugInfo=null)}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);