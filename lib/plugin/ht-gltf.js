!function(H,m,Z){"use strict";var K=H.ht,y=K.Default,N=y.getInternal(),U=(y.clone,y.def),o=K.WebGLConstants,w=K.Math.Matrix4,P=K.Math.Vector3;function d(U){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(U);for(var o="",s=0,f=U.length;s<f;s++)o+=String.fromCharCode(U[s]);try{return decodeURIComponent(escape(o))}catch(U){return o}}var L=new RegExp("[\\[\\]\\.:\\/]","g");function a(){this.userData={},this.matrix=new w,this.matrixWorld=new w,a.superClass.constructor.apply(this,arguments)}function O(U){for(var o in this.texture=!0,U)this[o]=U[o]}function z(U,o){this.mat=o,this.mesh=U,this.userData={},z.superClass.constructor.apply(this,arguments)}function C(){this.uuid=K.Math.generateUUID(),this.name="",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null}U(a,K.Data,{add:function(U){this.addChild(U)},traverse:function(U){y.traverse(this,U)},applyMatrix4:function(U){this.matrix.premultiply(U),this.getParent()?this.matrixWorld.multiplyMatrices(this.getParent().matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix)}});var b=function(){this.type="pbr",this.setValues=function(U){if(U){for(var o in U)this[o]=U[o];return this}},this.clone=function(){var U,o=new b;for(U in this)this[U]&&(o[U]=this[U]);return o}},s=(U(z,a,{normalizeSkinWeights:function(){var U=new K.Math.Vector4,o=this.mesh.attributes.skinWeight;if(o)for(var s=0,f=o.count;s<f;s++){U.fromBufferAttribute(o,s);var l=1/U.manhattanLength();l!=1/0?U.multiplyScalar(l):U.set(1,0,0,0),o.setXYZW(s,U.x,U.y,U.z,U.w)}}}),new K.Math.Matrix4);function p(U,o,s){this.name="",this.array=U,this.itemSize=o,this.count=U!==Z?U.length/o:0,this.normalized=!0===s,this.usage=K.WebGLConstants.STATIC_DRAW,this.updateRange={offset:0,count:-1},this.version=0}U(C,m,{setIndex:function(U){return Array.isArray(U)?this.index=new(65535<arrayMax(U)?x:Q)(U,1):this.index=U,this},setAttribute:function(U,o){return this.attributes[U]=o,this},deleteAttribute:function(U){return delete this.attributes[U],this},hasAttribute:function(U){return this.attributes[U]!==Z},applyMatrix4:function(U){var o=this.attributes.position,o=(o!==Z&&(o.applyMatrix4(U),o.needsUpdate=!0),this.attributes.normal),s=(o!==Z&&(s=(new K.Math.Matrix3).getNormalMatrix(U),o.applyNormalMatrix(s),o.needsUpdate=!0),this.attributes.tangent);return s!==Z&&(s.transformDirection(U),s.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},applyQuaternion:function(U){return s.makeRotationFromQuaternion(U),this.applyMatrix4(s),this},addGroup:function(U,o,s){this.groups.push({start:U,count:o,materialIndex:s||0})},setFromPoints:function(U){for(var o=[],s=0,f=U.length;s<f;s++){var l=U[s];o.push(l.x,l.y,l.z||0)}return this.setAttribute("position",new q(o,3)),this}}),m.defineProperty(p.prototype,"needsUpdate",{set:function(U){!0===U&&this.version++}});var f=new P;function l(U,o,s){p.call(this,new Int8Array(U),o,s)}function D(U,o,s){p.call(this,new Uint8Array(U),o,s)}function t(U,o,s){p.call(this,new Uint8ClampedArray(U),o,s)}function _(U,o,s){p.call(this,new Int16Array(U),o,s)}function Q(U,o,s){p.call(this,new Uint16Array(U),o,s)}function u(U,o,s){p.call(this,new Int32Array(U),o,s)}function x(U,o,s){p.call(this,new Uint32Array(U),o,s)}function q(U,o,s){p.call(this,new Float32Array(U),o,s)}function I(U,o,s){p.call(this,new Float64Array(U),o,s)}m.assign(p.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(U){return this.usage=U,this},copy:function(U){return this.name=U.name,this.array=new U.array.constructor(U.array),this.itemSize=U.itemSize,this.count=U.count,this.normalized=U.normalized,this.usage=U.usage,this},copyAt:function(U,o,s){U*=this.itemSize,s*=o.itemSize;for(var f=0,l=this.itemSize;f<l;f++)this.array[U+f]=o.array[s+f];return this},copyArray:function(U){return this.array.set(U),this},copyColorsArray:function(U){for(var o=this.array,s=0,f=0,l=U.length;f<l;f++){var m=U[f];m===Z?(o[s++]=1,o[s++]=1,o[s++]=1):(o[s++]=m.r,o[s++]=m.g,o[s++]=m.b)}return this},copyVector2sArray:function(U){for(var o=this.array,s=0,f=0,l=U.length;f<l;f++){var m=U[f];m===Z&&(m=new Vector2),o[s++]=m.x,o[s++]=m.y}return this},copyVector3sArray:function(U){for(var o=this.array,s=0,f=0,l=U.length;f<l;f++){var m=U[f];m===Z&&(m=new P),o[s++]=m.x,o[s++]=m.y,o[s++]=m.z}return this},copyVector4sArray:function(U){for(var o=this.array,s=0,f=0,l=U.length;f<l;f++){var m=U[f];m===Z&&(m=new Vector4),o[s++]=m.x,o[s++]=m.y,o[s++]=m.z,o[s++]=m.w}return this},applyMatrix3:function(U){for(var o=0,s=this.count;o<s;o++)f.x=this.getX(o),f.y=this.getY(o),f.z=this.getZ(o),f.applyMatrix3(U),this.setXYZ(o,f.x,f.y,f.z);return this},applyMatrix4:function(U){for(var o=0,s=this.count;o<s;o++)f.x=this.getX(o),f.y=this.getY(o),f.z=this.getZ(o),f.applyMatrix4(U),this.setXYZ(o,f.x,f.y,f.z);return this},applyNormalMatrix:function(U){for(var o=0,s=this.count;o<s;o++)f.x=this.getX(o),f.y=this.getY(o),f.z=this.getZ(o),f.applyNormalMatrix(U),this.setXYZ(o,f.x,f.y,f.z);return this},transformDirection:function(U){for(var o=0,s=this.count;o<s;o++)f.x=this.getX(o),f.y=this.getY(o),f.z=this.getZ(o),f.transformDirection(U),this.setXYZ(o,f.x,f.y,f.z);return this},set:function(U,o){return this.array.set(U,o=o===Z?0:o),this},getX:function(U){return this.array[U*this.itemSize]},setX:function(U,o){return this.array[U*this.itemSize]=o,this},getY:function(U){return this.array[U*this.itemSize+1]},setY:function(U,o){return this.array[U*this.itemSize+1]=o,this},getZ:function(U){return this.array[U*this.itemSize+2]},setZ:function(U,o){return this.array[U*this.itemSize+2]=o,this},getW:function(U){return this.array[U*this.itemSize+3]},setW:function(U,o){return this.array[U*this.itemSize+3]=o,this},setXY:function(U,o,s){return U*=this.itemSize,this.array[U+0]=o,this.array[U+1]=s,this},setXYZ:function(U,o,s,f){return U*=this.itemSize,this.array[U+0]=o,this.array[U+1]=s,this.array[U+2]=f,this},setXYZW:function(U,o,s,f,l){return U*=this.itemSize,this.array[U+0]=o,this.array[U+1]=s,this.array[U+2]=f,this.array[U+3]=l,this},onUpload:function(U){return this.onUploadCallback=U,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),(l.prototype=m.create(p.prototype)).constructor=l,(D.prototype=m.create(p.prototype)).constructor=D,(t.prototype=m.create(p.prototype)).constructor=t,(_.prototype=m.create(p.prototype)).constructor=_,Q.prototype=m.create(p.prototype),Q.prototype.constructor=Q,(u.prototype=m.create(p.prototype)).constructor=u,x.prototype=m.create(p.prototype),x.prototype.constructor=x,(q.prototype=m.create(p.prototype)).constructor=q,(I.prototype=m.create(p.prototype)).constructor=I;var g={5:"triangleStrip",6:"triangleFan",1:"lines",2:"lineLoop",3:"lineStrip"},v=(g[o.POINTS]="points",{position:"vs",normal:"ns"}),i=new w,R=K.Math.newIdGenerator(),A=function(U,o,s,f,l){var m=o.mat;if(m){var D=l[m.name||(m.name="material_"+R.next())]={};for(H in m)"name"!==H&&"setValues"!==H&&"clone"!==H&&(D[H]=m[H]);U.mat=m.name}var t=o.mesh;if(t){U.mesh=_={},t.index&&(_.is=t.index.array);var _,H,O=t.attributes;for(H in O){var y=v[H]||H;s.ignoreNormal&&"ns"===y||(_[y]=O[H].array)}}o.matrix&&!o.matrix.equals(i)?decomposeTRS(U,o.matrix):(o.position&&(U.position=o.position),(o.rotation||o.quaternion)&&(U.quaternion=o.rotation||o.quaternion),o.scale&&(U.scale=o.scale)),o.userData&&(t=o.userData.transformData)&&(t.rotationOffset||t.rotationPivot||t.scalingOffset||t.scalingPivot)&&((C=U.transformData={}).translation=t.translation||[0,0,0],t.rotation?((d=t.rotation.map(degToRad)).push(t.eulerOrder),C.rotation=d):C.rotation=[0,0,0,1],C.scale=t.scale||[1,1,1],copyIfExists(C,t,"rotationOffset"),copyIfExists(C,t,"rotationPivot"),copyIfExists(C,t,"scalingOffset"),copyIfExists(C,t,"scalingPivot")),o.matrixWorld=(new w).composeFromArray(U.position,U.quaternion,U.scale),o._matrixWorldNeedUpdate=!0;o.isBone&&(U.isBone=!0),U.name=o.name,U.ID=o.ID;var N,d=o.skeleton,C=(d&&(U.skeleton=d),o.animations),a=(C&&(U.animations=C),o.getChildren().getArray());if(a){U.comps=[];for(var z=0,b=a.length;z<b;z++)U.comps.push(N={}),A(N,a[z],s,f,l)}};function J(U,_,H){var O=K.Math.generateUUID();y.addPendingPlaceholder(O),new X(_).parse(U,"",function(U){var o,C={model3d:!0,matDef:{}},s=U.scene,f=(A(C,s,_,{},C.matDef),y.traverse(C,null,function(U){var o=C.matDef,s=U.mat;if(s&&(s=o[s])&&s.map){o=s.map.uvMatrix;if(o){s=U.mesh;if(s){var f=s.uv;if(f){for(var l=new Float32Array(f.length),m=o[0],D=o[1],t=o[3],_=o[4],H=o[6],O=o[7],y=0;y<f.length;y+=2){var N=f[y],d=f[y+1];l[y]=m*N+t*d+H,l[y+1]=D*N+_*d+O}s.uv=l}}}}},"comps"),U.animations),f=(f&&(C.animations=f),U.assets),l=(f&&(C.assets=f),{}),m={};y.traverse(C,null,function(U){if(l[U.name]){for(U.displayName=U.name;o=U.name+"_"+K.Math.generateIncreasingID(),l[o];);U.name=o}l[U.name]=U.ID,m[U.ID]=U.name,delete U.ID},"comps"),C.animations&&C.animations.forEach(function(U){U.tracks.forEach(function(U){var o=U.name.split(".");o[0]&&m[o[0]]&&(U.name=m[o[0]]+"."+o.slice(1).join("."))})}),y.traverse(C,null,function(U){var o=U.skeleton;if(o){for(var s=o[0],f=s.length,l=new Array(f),m=0;m<f;m++)l[m]=s[m].name;U.skeleton={bones:l,boneMatrixInverses:o[1],bindMatrix:o[2].toArray(),bindMatrixInverse:(new w).copy(o[2]).invert().toArray()}}},"comps"),y.traverse(C,null,function(U){var o=U.comps;if(o)for(var s=o.length-1;0<=s;s--){var f=o[s];f.mesh||f.isBone||f.comps&&f.comps.length||o.splice(s,1)}},"comps"),N.completeCubeCenterOfModel3d(C,{scene:s,cube:_.cube,center:_.center,rotationMode:_.rotationMode,t3:_.t3,r3:_.r3,s3:_.s3});_.flipY&&y.traverse(C,function(U){U=U.mesh;if(U&&(U.uv||U.uv2)){for(var o=1,s=U.uv,f=s?s.length:0;o<f;o+=2)s[o]=1-s[o];for(o=1,f=(s=U.uv2)?s.length:0;o<f;o+=2)s[o]=1-s[o]}},null,"comps");var D=_.matDef;if(D)if(C.matDef)for(var t in D)C.matDef[t]=D[t];else C.matDef=D;_.shape3d&&y.setShape3dModel(_.shape3d,C),_.playAutomatically&&(C.playAutomatically=!0),U.externalAssetURIs&&(C.externalAssetURIs=U.externalAssetURIs),!_.ignoreNormal&&_.mikktTangent&&K.Math.MikktSpaceAlgorithm&&K.Math.MikktSpaceAlgorithm.generateMikktTangents(C,_.tangentFlipW),H&&H(C),y.removePendingPlaceholder(O,C)},function(U){console.error(U),H&&H(null),y.removePendingPlaceholder(O,null)})}function Y(U,o,s,f){if("string"!=typeof U||0<=U.indexOf("data:")||0<=U.indexOf("blob:"))return f(U,!0);if(o){o=o[U];if(o)return f(o)}y.convertGltfAssetsURL?y.convertGltfAssetsURL(U,s,f):f(s+U)}N.addMethod(y,{loadGltf:function(f,l){if(!(l=l||{}).path)for(var U=f.length-1;0<=U;U--){var o=f.charAt(U);if("/"===o||"\\"===o){l.path=f.substring(0,U+1);break}}l.responseType="arraybuffer",y.xhrLoad(f,function(U){var s;U=U,s=l.finishFunc,U||s(null),J(U,l,function(U){var o=l.shape3d;U?s&&s(U,f,o):s&&s(null)})},l)},parseGltf:J,convertGltfAssetsURL:null});var X=function(U){U=U||{},this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.assetsURIMap=U.assetsURIMap,this.path=U.path||"",this.register(function(U){return new S(U)}),this.register(function(U){return new US(U)}),this.register(function(U){return new oS(U)}),this.register(function(U){return new $(U)}),this.register(function(U){return new r(U)}),this.register(function(U){return new E(U)}),this.register(function(U){return new c(U)}),this.register(function(U){return new B(U)}),this.register(function(U){return new n(U)}),this.register(function(U){return new sS(U)})};function e(){var s={};return{get:function(U){return s[U]},add:function(U,o){s[U]=o},remove:function(U){delete s[U]},removeAll:function(){s={}}}}U(X,m,{getDRACOLoader:function(){var U=this.dracoLoader;return U||(U=(new wS).setDecoderPath(y.dracoLibraryPath||""),this.setDRACOLoader(U),U)},setDRACOLoader:function(U){return this.dracoLoader=U,this},setDDSLoader:function(){throw new Error('GLTFLoader: use "KHR_texture_basisu" instead.')},setKTX2Loader:function(U){return this.ktx2Loader=U,this},setMeshoptDecoder:function(U){return this.meshoptDecoder=U,this},register:function(U){return-1===this.pluginCallbacks.indexOf(U)&&this.pluginCallbacks.push(U),this},unregister:function(U){return-1!==this.pluginCallbacks.indexOf(U)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(U),1),this},parse:function(U,o,s,f){var l,m={},D={};if("string"==typeof U)l=U;else if(d(new Uint8Array(U,0,4))===fS){try{m[V.KHR_BINARY_GLTF]=new DS(U)}catch(U){return void(f&&f(U))}l=m[V.KHR_BINARY_GLTF].content}else l=d(new Uint8Array(U));var t=JSON.parse(l);if(t.asset===Z||t.asset.version[0]<2)f&&f(new Error("GLTFLoader: only glTF versions >=2.0 are supported."));else{for(var _=new zS(t,{assetsURIMap:this.assetsURIMap,path:o||this.resourcePath||this.path||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder}),H=0;H<this.pluginCallbacks.length;H++){var O=this.pluginCallbacks[H](_);m[(D[O.name]=O).name]=!0}if(t.extensionsUsed)for(H=0;H<t.extensionsUsed.length;++H){var y=t.extensionsUsed[H],N=t.extensionsRequired||[];switch(y){case V.KHR_MATERIALS_UNLIT:m[y]=new M;break;case V.KHR_DRACO_MESH_COMPRESSION:m[y]=new tS(t,this.getDRACOLoader());break;case V.KHR_TEXTURE_TRANSFORM:m[y]=new _S;break;case V.KHR_MESH_QUANTIZATION:m[y]=new HS;break;default:0<=N.indexOf(y)&&D[y]===Z&&console.warn('GLTFLoader: Unknown extension "'+y+'".')}}_.setExtensions(m),_.setPlugins(D),_.parse(s,f)}},parseAsync:function(s,f){var l=this;return new Promise(function(U,o){l.parse(s,f,U,o)})}});var V={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},n=function(U){this.parser=U,this.name=V.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}},M=(U(n,m,{_markDefs:function(){},createNodeAttachment:function(){return null}}),function(){this.name=V.KHR_MATERIALS_UNLIT}),B=(U(M,m,{getMaterialType:function(){return j},extendParams:function(U,o,s){var f,l=[],o=(U.diffuse=[1,1,1],U.opacity=1,o.pbrMetallicRoughness);return o&&(Array.isArray(o.baseColorFactor)&&(f=o.baseColorFactor,U.diffuse=f,U.opacity=f[3]),o.baseColorTexture!==Z&&l.push(s.assignTexture(U,"map",o.baseColorTexture))),Promise.all(l)}}),function(U){this.parser=U,this.name=V.KHR_MATERIALS_SPECULAR}),o=(U(B,m,{getMaterialType:function(U){U=this.parser.json.materials[U];return U.extensions&&U.extensions[this.name]?j:null},extendParams:function(U,o,s){if(!(o=(s=this.parser).json.materials[materialIndex]).extensions||!o.extensions[this.name])return Promise.resolve();var f=[],o=o.extensions[this.name],l=(U.specularIntensity=o.specularFactor!==Z?o.specularFactor:1,o.specularTexture!==Z&&f.push(s.assignTexture(U,"specularIntensityMap",o.specularTexture)),o.specularColorFactor||[1,1,1]);return U.specularColor=[l[0],l[1],l[2]],o.specularColorTexture!==Z&&f.push(s.assignTexture(U,"specularColorMap",o.specularColorTexture)),Promise.all(f)}}),{getMaterialType:function(U){U=this.parser.json.materials[U];return U.extensions&&U.extensions[this.name]?j:null},extendParams:function(){return Promise.resolve()}}),S=function(U){this.parser=U,this.name=V.KHR_MATERIALS_CLEARCOAT},$=(U(S,m,o),function(U){this.parser=U,this.name=V.KHR_MATERIALS_SHEEN}),r=(U($,m,o),function(U){this.parser=U,this.name=V.KHR_MATERIALS_TRANSMISSION}),E=(U(r,m,o),function(U){this.parser=U,this.name=V.KHR_MATERIALS_VOLUME}),c=(U(E,m,o),function(U){this.parser=U,this.name=V.KHR_MATERIALS_IOR}),US=(U(c,m,o),function(U){this.parser=U,this.name=V.KHR_TEXTURE_BASISU}),oS=(U(US,m,{loadTexture:function(U){var o=this.parser,s=o.json,f=s.textures[U];if(!f.extensions||!f.extensions[this.name])return null;var f=f.extensions[this.name],l=o.options.ktx2Loader;if(l)return o.loadTextureImage(U,f.source,l);if(s.extensionsRequired&&0<=s.extensionsRequired.indexOf(this.name))throw new Error("GLTFLoader: setKTX2Loader must be called");return null}}),function(U){this.parser=U,this.name=V.EXT_TEXTURE_WEBP,this.isSupported=null}),sS=(U(oS,m,{loadTexture:function(o){var s=this.name,f=this.parser,l=f.json,U=l.textures[o];if(!U.extensions||!U.extensions[s])return null;var U=U.extensions[s],m=l.images[U.source],D=f.textureLoader;return this.detectSupport().then(function(U){if(U)return f.loadTextureImage(o,m,D);if(l.extensionsRequired&&0<=l.extensionsRequired.indexOf(s))throw new Error("GLTFLoader: WebP required by asset but unsupported.");return f.loadTexture(o)})},detectSupport:function(){return this.isSupported||(this.isSupported=new Promise(function(U){var o=new Image;o.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",o.onload=o.onerror=function(){U(1===o.height)}})),this.isSupported}}),function(U){this.parser=U,this.name=V.EXT_MESHOPT_COMPRESSION}),fS=(U(sS,m,{loadBufferView:function(U){var o=this.parser.json,U=o.bufferViews[U];if(U.extensions&&U.extensions[this.name]){var D=U.extensions[this.name],U=this.parser.getDependency("buffer",D.buffer),t=this.parser.options.meshoptDecoder;if(t&&t.supported)return Promise.all([U,t.ready]).then(function(U){var o=D.byteOffset||0,s=D.byteLength||0,f=D.count,l=D.byteStride,m=new ArrayBuffer(f*l),U=new Uint8Array(U[0],o,s);return t.decodeGltfBuffer(new Uint8Array(m),f,l,U,D.mode,D.filter),m});if(o.extensionsRequired&&0<=o.extensionsRequired.indexOf(this.name))throw new Error("GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return null}}),"glTF"),lS=1313821514,mS=5130562,DS=function(U){this.name=V.KHR_BINARY_GLTF,this.content=null,this.body=null;var o=new DataView(U,0,12);if(this.header={magic:d(new Uint8Array(U.slice(0,4))),version:o.getUint32(4,!0),length:o.getUint32(8,!0)},this.header.magic!==fS)throw new Error("GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("GLTFLoader: Legacy binary file detected.");for(var s=this.header.length-12,f=new DataView(U,12),l=0;l<s;){var m,D=f.getUint32(l,!0),t=(l+=4,f.getUint32(l,!0));l+=4,t===lS?(m=new Uint8Array(U,12+l,D),this.content=d(m)):t===mS&&(this.body=U.slice(m=12+l,m+D)),l+=D}if(null===this.content)throw new Error("GLTFLoader: JSON content not found.")},tS=function(U,o){if(!o)throw new Error("GLTFLoader: No DRACOLoader instance provided.");this.name=V.KHR_DRACO_MESH_COMPRESSION,this.json=U,this.dracoLoader=o,this.dracoLoader.preload()},_S=(U(tS,m,{decodePrimitive:function(U,o){var s,f=this.json,l=this.dracoLoader,m=U.extensions[this.name].bufferView,D=U.extensions[this.name].attributes,t={},_={},H={};for(s in D){var O=k[s]||s.toLowerCase();t[O]=D[s]}for(s in U.attributes){var y,N,O=k[s]||s.toLowerCase();D[s]!==Z&&(y=f.accessors[U.attributes[s]],N=W[y.componentType],H[O]=N.name,_[O]=!0===y.normalized)}return o.getDependency("bufferView",m).then(function(U){return new Promise(function(f){l.decodeDracoFile(U,function(U){for(var o in U.attributes){var s=U.attributes[o],o=_[o];o!==Z&&(s.normalized=o)}f(U)},t,H)})})}}),function(){this.name=V.KHR_TEXTURE_TRANSFORM}),HS=(U(_S,m,{extendTexture:function(U,o){if(o.texCoord!==Z&&console.warn('GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),o.offset===Z&&o.rotation===Z&&o.scale===Z)return U;o=N.makeUVMatrixArray(o.rotation,o.offset,o.scale);return U.uvMatrix=o,U}}),function(){this.name=V.KHR_MESH_QUANTIZATION}),W={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},OS={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},k={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},yS={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},NS="OPAQUE",dS="MASK",CS="BLEND",j=function(U){var o=(new b).setValues({type:"pbr"});return U&&o.setValues(U),o};function h(U,o,s){for(var f in s.extensions)U[f]===Z&&o.userData&&(o.userData.gltfExtensions=o.userData.gltfExtensions||{},o.userData.gltfExtensions[f]=s.extensions[f])}function F(U,o){var s,o=o.extras;o!==Z&&("object"==typeof o?((s=U.userData)||(U.userData=s={}),m.assign(s,o)):console.warn("GLTFLoader: Ignoring primitive type .extras, "+o))}function aS(U){for(var o="",s=m.keys(U).sort(),f=0,l=s.length;f<l;f++)o+=s[f]+":"+U[s[f]]+";";return o}function G(U){switch(U){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("GLTFLoader: Unsupported normalized accessor component type.")}}var zS=function(U,o){o=o||{},this.json=U=U||{},this.extensions={},this.plugins={},this.options=o,this.cache=new e,this.associations=new Map,this.primitiveCache={},this.assetsURIMap=o.assetsURIMap,this.path=o.path,this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={},this.assets=[],this.externalAssetURIs=[],this.nameIdGenerator=K.Math.newIdGenerator()};function bS(s,U,f){var o,l=U.attributes,m=[];for(o in l){var D=k[o]||o.toLowerCase();D in s.attributes||m.push(function(U,o){return f.getDependency("accessor",U).then(function(U){s.setAttribute(o,U)})}(l[o],D))}U.indices===Z||s.index||(t=f.getDependency("accessor",U.indices).then(function(U){s.setIndex(U)}),m.push(t)),F(s,U);var t=s,_=f,H=U.attributes,O=new K.Math.Box3;if(H.POSITION!==Z){var y=(w=_.json.accessors[H.POSITION]).min,N=w.max;if(y===Z||N===Z)console.warn("GLTFLoader: Missing min/max properties for accessor POSITION.");else{O.set(new P(y[0],y[1],y[2]),new P(N[0],N[1],N[2])),w.normalized&&(Q=G(W[w.componentType]),O.min.multiplyScalar(Q),O.max.multiplyScalar(Q));var d=U.targets;if(d!==Z){for(var C=new P,a=new P,z=0,b=d.length;z<b;z++){var w,Q,u=d[z];u.POSITION!==Z&&(y=(w=_.json.accessors[u.POSITION]).min,N=w.max,y!==Z&&N!==Z?(a.setX(Math.max(Math.abs(y[0]),Math.abs(N[0]))),a.setY(Math.max(Math.abs(y[1]),Math.abs(N[1]))),a.setZ(Math.max(Math.abs(y[2]),Math.abs(N[2]))),w.normalized&&(Q=G(W[w.componentType]),a.multiplyScalar(Q)),C.max(a)):console.warn("GLTFLoader: Missing min/max properties for accessor POSITION."))}O.expandByPoint(C)}t.boundingBox=O;H=new K.Math.Sphere;O.getCenter(H.center),H.radius=O.min.distanceTo(O.max)/2,t.boundingSphere=H}}return Promise.all(m).then(function(){return s})}U(zS,m,{setExtensions:function(U){this.extensions=U},setPlugins:function(U){this.plugins=U},parse:function(s,U){var f=this,l=this.json,m=this.extensions,D=this.assets;this.cache.removeAll(),this._invokeAll(function(U){return U._markDefs&&U._markDefs()}),Promise.all(this._invokeAll(function(U){return U.beforeRoot&&U.beforeRoot()})).then(function(){return Promise.all([f.getDependencies("scene"),f.getDependencies("animation")])}).then(function(U){var o={scene:U[0][l.scene||0],scenes:U[0],animations:U[1],cameras:U[2],asset:l.asset,parser:f,userData:{},externalAssetURIs:f.externalAssetURIs};D.length&&(o.assets=D),h(m,o,l),F(o,l),Promise.all(f._invokeAll(function(U){return U.afterRoot&&U.afterRoot(o)})).then(function(){s(o)})}).catch(U)},_markDefs:function(){for(var U=this.json.nodes||[],o=this.json.skins||[],s=this.json.meshes||[],f=0,l=o.length;f<l;f++)for(var m=o[f].joints,D=0,t=m.length;D<t;D++)U[m[D]].isBone=!0;for(var _=0,H=U.length;_<H;_++){var O=U[_];O.mesh!==Z&&(this._addNodeRef(this.meshCache,O.mesh),O.skin!==Z&&(s[O.mesh].isSkinnedMesh=!0)),O.camera!==Z&&this._addNodeRef(this.cameraCache,O.camera)}},_addNodeRef:function(U,o){o!==Z&&(U.refs[o]===Z&&(U.refs[o]=U.uses[o]=0),U.refs[o]++)},_getNodeRef:function(U,o,s){if(U.refs[o]<=1)return s;var f,l,m=new z(s.geometry,s.material);for(f in s)"geometry"!==f&&"material"!==f&&"_id"!==f&&(l=s[f],m[f]=l&&l.clone?l.clone():l);var D=this,t=function(U,o){var s=D.associations.get(U);null!=s&&D.associations.set(o,s);for(var f=0,s=U.children,l=s?s.length:0;f<l;f++)t(U.children[f],o.children[f])};return t(s,m),m.name+="_instance_"+U.uses[o]++,m},_invokeOne:function(U){var o=m.values(this.plugins);o.push(this);for(var s=0;s<o.length;s++){var f=U(o[s]);if(f)return f}return null},_invokeAll:function(U){for(var o=m.values(this.plugins),s=(o.unshift(this),[]),f=0;f<o.length;f++){var l=U(o[f]);l&&s.push(l)}return s},getDependency:function(U,o){var s=U+":"+o,f=this.cache.get(s);if(!f){switch(U){case"scene":f=this.loadScene(o);break;case"node":f=this.loadNode(o);break;case"mesh":f=this._invokeOne(function(U){return U.loadMesh&&U.loadMesh(o)});break;case"accessor":f=this.loadAccessor(o);break;case"bufferView":f=this._invokeOne(function(U){return U.loadBufferView&&U.loadBufferView(o)});break;case"buffer":f=this.loadBuffer(o);break;case"material":f=this._invokeOne(function(U){return U.loadMaterial&&U.loadMaterial(o)});break;case"texture":f=this._invokeOne(function(U){return U.loadTexture&&U.loadTexture(o)});break;case"skin":f=this.loadSkin(o);break;case"animation":f=this.loadAnimation(o);break;case"camera":f=this.loadCamera(o);break;default:throw new Error("Unknown type: "+U)}this.cache.add(s,f)}return f},getDependencies:function(s){var f,U,o=this.cache.get(s);return o||(U=(f=this).json[s+("mesh"===s?"es":"s")]||[],o=Promise.all(U.map(function(U,o){return f.getDependency(s,o)})),this.cache.add(s,o)),o},loadBuffer:function(U){var l=this.json.buffers[U];if(l.type&&"arraybuffer"!==l.type)throw new Error("GLTFLoader: "+l.type+" buffer type is not supported.");if(l.uri===Z&&0===U)return Promise.resolve(this.extensions[V.KHR_BINARY_GLTF].body);var o=this.path,m=this.assets,D=this.externalAssetURIs,t=this.assetsURIMap;return new Promise(function(s,f){var U=l.uri;U.indexOf("data:")<0&&D.indexOf(U)<0&&D.push(U),Y(U,t,o,function(U,o){o||m.push(U),K.Default.xhrLoad(U,function(U){U?s(U):f(new Error('GLTFLoader: Failed to load buffer "'+l.uri+'".'))},{responseType:"arraybuffer"})})})},loadBufferView:function(U){var f=this.json.bufferViews[U];return this.getDependency("buffer",f.buffer).then(function(U){var o=f.byteLength||0,s=f.byteOffset||0;return U.slice(s,s+o)})},loadAccessor:function(U){var Q=this.json,u=this.json.accessors[U];if(u.bufferView===Z&&u.sparse===Z)return Promise.resolve(null);U=[];return u.bufferView!==Z?U.push(this.getDependency("bufferView",u.bufferView)):U.push(null),u.sparse!==Z&&(U.push(this.getDependency("bufferView",u.sparse.indices.bufferView)),U.push(this.getDependency("bufferView",u.sparse.values.bufferView))),Promise.all(U).then(function(U){var o,s=U[0],f=OS[u.type],l=W[u.componentType],m=l.BYTES_PER_ELEMENT,D=u.byteOffset||0,t=u.bufferView!==Z?Q.bufferViews[u.bufferView].byteStride:Z,_=!0===u.normalized;if(t&&t!==m*f){for(var H=new l(u.count*f),O=Math.round(t/m),y=D%t/m,N=new l(s,Math.floor(D/t)*t,u.count*t/m),d=0;d<u.count;d++)for(var C=0;C<f;C++){var a=d*O+C+y;H[d*f+C]=N[a]}o=new p(H,f,_)}else o=new p(H=null===s?new l(u.count*f):new l(s,D,u.count*f),f,_);if(u.sparse!==Z){var t=W[u.sparse.indices.componentType],m=u.sparse.indices.byteOffset||0,D=u.sparse.values.byteOffset||0,z=new t(U[1],m,u.sparse.count*OS.SCALAR),b=new l(U[2],D,u.sparse.count*f);null!==s&&(o=new p(o.array.slice(),o.itemSize,o.normalized));for(var d=0,w=z.length;d<w;d++){a=z[d];if(o.setX(a,b[d*f]),2<=f&&o.setY(a,b[d*f+1]),3<=f&&o.setZ(a,b[d*f+2]),4<=f&&o.setW(a,b[d*f+3]),5<=f)throw new Error("GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o})},loadTexture:function(U){var o=this.json.textures[U].source,s=this.textureLoader;return this.loadTextureImage(U,o,s)},loadTextureImage:function(s,U,o){var f=this,l=this.json,m=l.textures[s],D=l.images[U],D=(D.uri||D.bufferView)+":"+m.sampler;if(this.textureCache[D])return this.textureCache[D];U=this.loadImageSource(U,o).then(function(U){U.flipY=!1,m.name&&(U.name=m.name);var o=(l.samplers||{})[m.sampler]||{};return o.magFilter!==Z&&(U.magFilter=o.magFilter),o.minFilter!==Z&&(U.minFilter=o.minFilter),o.wrapS!==Z&&(U.wrapS=o.wrapS),o.wrapT!==Z&&(U.wrapT=o.wrapT),f.associations.set(U,{textures:s}),U}).catch(function(){return null});return this.textureCache[D]=U},loadImageSource:function(U,o){var s=this.json;if(this.sourceCache[U]!==Z)return this.sourceCache[U].then(function(U){U.clone()});var m=s.images[U],f=H.URL||H.webkitURL,l=m.uri,D=("string"==typeof l&&l.indexOf("data:")<0?(s=this.externalAssetURIs).indexOf(l)<0&&s.push(l):l=l||"",!1);if(m.bufferView!==Z)l=this.getDependency("bufferView",m.bufferView).then(function(U){D=!0;U=new Blob([U],{type:m.mimeType});return l=f.createObjectURL(U)});else if(m.uri===Z)throw new Error("GLTFLoader: Image "+U+" is missing URI and bufferView");var t=this.assetsURIMap,_=this.path,s=Promise.resolve(l).then(function(s){return new Promise(function(o,U){Y(s,t,_,function(U){o(U)})})}).then(function(l){return new Promise(function(U,o){var s,f=decodeURIComponent(l);D?((s=new Image).src=f,s.onload=function(){U(new O({image:s,mimeType:m.mimeType}))}):U(new O({image:f}))})}).then(function(U){return!0===D&&f.revokeObjectURL(l),U}).catch(function(U){throw console.error("GLTFLoader: Couldn't load texture",l),U});return this.sourceCache[U]=s},assignTexture:function(f,l,m){var D=this;return this.getDependency("texture",m.index).then(function(U){var o,s;return m.texCoord===Z||0==m.texCoord||"aoMap"===l&&1==m.texCoord||console.warn("GLTFLoader: Custom UV set "+m.texCoord+" for texture "+l+" not yet supported."),D.extensions[V.KHR_TEXTURE_TRANSFORM]&&(o=m.extensions!==Z?m.extensions[V.KHR_TEXTURE_TRANSFORM]:Z)&&(s=D.associations.get(U),U=D.extensions[V.KHR_TEXTURE_TRANSFORM].extendTexture(U,o),D.associations.set(U,s)),f[l]=U})},assignFinalMaterial:function(U){var o,s,f=U.mesh,l=U.mat,m=f.attributes.tangent===Z,D=f.attributes.color!==Z,t=f.attributes.normal===Z;(m||D||t)&&(o="ClonedMaterial:"+l.uuid+":",l.isGLTFSpecularGlossinessMaterial&&(o+="specular-glossiness:"),m&&(o+="derivative-tangents:"),D&&(o+="vertex-colors:"),t&&(o+="flat-shading:"),(s=this.cache.get(o))||(s=l.clone(),D&&(s.vertexColors=!0),t&&(s.flatShading=!0),m&&(s.normalScale&&(s.normalScale.y*=-1),s.clearcoatNormalScale&&(s.clearcoatNormalScale.y*=-1)),this.cache.add(o,s),this.associations.set(s,this.associations.get(l))),l=s),l.aoMap&&f.attributes.uv2===Z&&f.attributes.uv!==Z&&f.setAttribute("uv2",f.attributes.uv),U.material=l},getMaterialType:function(){return j},loadMaterial:function(o){var s,f=this,U=this.json,l=this.extensions,m=U.materials[o],D={},U=m.extensions||{},t=[],_=(U[V.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]?(_=l[V.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS],s=_.getMaterialType(),t.push(_.extendParams(D,m,f))):U[V.KHR_MATERIALS_UNLIT]?(_=l[V.KHR_MATERIALS_UNLIT],s=_.getMaterialType(),t.push(_.extendParams(D,m,f))):(U=m.pbrMetallicRoughness||{},D.diffuse=[1,1,1],D.opacity=1,Array.isArray(U.baseColorFactor)&&(_=U.baseColorFactor,D.diffuse=_,D.opacity=_[3]),U.baseColorTexture!==Z&&t.push(f.assignTexture(D,"map",U.baseColorTexture)),D.metalness=U.metallicFactor!==Z?U.metallicFactor:1,D.roughness=U.roughnessFactor!==Z?U.roughnessFactor:1,U.metallicRoughnessTexture!==Z&&(t.push(f.assignTexture(D,"metalnessMap",U.metallicRoughnessTexture)),t.push(f.assignTexture(D,"roughnessMap",U.metallicRoughnessTexture))),s=this._invokeOne(function(U){return U.getMaterialType&&U.getMaterialType(o)}),t.push(Promise.all(this._invokeAll(function(U){return U.extendMaterialParams&&U.extendMaterialParams(o,D)})))),!0===m.doubleSided&&(D.cullFace=!1),m.alphaMode||NS);return _===CS?(D.transparent=!0,D.depthWrite=!1):(D.transparent=!1,_===dS&&(D.alphaTest=m.alphaCutoff!==Z?m.alphaCutoff:.5)),m.normalTexture!==Z&&(t.push(f.assignTexture(D,"normalMap",m.normalTexture)),D.normalScale=[1,1],m.normalTexture.scale!==Z&&(U=m.normalTexture.scale,D.normalScale=[U,U])),m.occlusionTexture!==Z&&(t.push(f.assignTexture(D,"aoMap",m.occlusionTexture)),m.occlusionTexture.strength!==Z&&(D.aoMapIntensity=m.occlusionTexture.strength)),m.emissiveFactor!==Z&&(D.emissive=m.emissiveFactor),m.emissiveTexture!==Z&&t.push(f.assignTexture(D,"emissiveMap",m.emissiveTexture)),Promise.all(t).then(function(){var U=(new s).setValues(D);return m.name&&(U.name=m.name),F(U,m),f.associations.set(U,{materials:o}),m.extensions&&h(l,U,m),U.roughnessMap&&(U.roughnessChannel="G"),U.metalnessMap&&(U.metalnessChannel="B"),U.aoMap&&(U.aoChannel="R",U.aoUvChannel=2),U})},createUniqueName:function(U){for(var o=(U||"").replace(/\s/g,"_").replace(L,""),s=o,f=1;this.nodeNamesUsed[s];++f)s=o+"_"+f;return this.nodeNamesUsed[s]=!0,s},loadGeometries:function(U){var s=this,f=this.extensions,o=this.primitiveCache;for(var l=[],m=0,D=U.length;m<D;m++){var t=U[m],_=(H=void 0,H=(H=(_=t).extensions&&_.extensions[V.KHR_DRACO_MESH_COMPRESSION])?"draco:"+H.bufferView+":"+H.indices+":"+aS(H.attributes):_.indices+":"+aS(_.attributes)+":"+_.mode),H=o[_];H?l.push(H.promise):(H=t.extensions&&t.extensions[V.KHR_DRACO_MESH_COMPRESSION]?function(o){return f[V.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,s).then(function(U){return bS(U,o,s)})}(t):bS(new C,t,s),o[_]={primitive:t,promise:H},l.push(H))}return Promise.all(l)},loadMesh:function(O){for(var y=this,U=this.json,N=this.extensions,d=U.meshes[O],C=d.primitives,o=[],s=0,f=C.length;s<f;s++){var l=C[s].material===Z?((l=this.cache).DefaultMaterial===Z&&(l.DefaultMaterial=j()),l.DefaultMaterial):this.getDependency("material",C[s].material);o.push(l)}return o.push(y.loadGeometries(C)),Promise.all(o).then(function(U){for(var o=U.slice(0,U.length-1),s=U[U.length-1],f=[],l=0,m=s.length;l<m;l++){var D=s[l],t=C[l],_=o[l],D=new z(D,_);t.mode!==Z&&(_.renderMode=g[t.mode]||"triangles"),D.name=y.createUniqueName(d.name||"mesh_"+O),F(D,d),t.extensions&&h(N,D,t),y.assignFinalMaterial(D),D.normalizeSkinWeights(),f.push(D)}for(l=0,m=f.length;l<m;l++)y.associations.set(f[l],{meshes:O,primitives:l});if(1===f.length)return f[0];var H=new a;y.associations.set(H,{meshes:O});for(l=0,m=f.length;l<m;l++)H.add(f[l]);return H})},loadCamera:function(U){return Promise.resolve(new K.Camera)},loadSkin:function(U){var U=this.json.skins[U],o={joints:U.joints};return U.inverseBindMatrices===Z?Promise.resolve(o):this.getDependency("accessor",U.inverseBindMatrices).then(function(U){return o.inverseBindMatrices=U,o})},loadAnimation:function(P){for(var p=this.json.animations[P],U=[],o=[],s=[],f=[],l=[],x=this.nameIdGenerator,m=0,D=p.channels.length;m<D;m++){var t=p.channels[m],q=p.samplers[t.sampler],t=t.target,_=t.node,H=p.parameters!==Z?p.parameters[q.input]:q.input,O=p.parameters!==Z?p.parameters[q.output]:q.output;U.push(this.getDependency("node",_)),o.push(this.getDependency("accessor",H)),s.push(this.getDependency("accessor",O)),f.push(q),l.push(t)}return Promise.all([Promise.all(U),Promise.all(o),Promise.all(s),Promise.all(f),Promise.all(l)]).then(function(U){for(var o=U[0],s=U[1],f=U[2],l=U[4],m=[],D=0,t=o.length;D<t;D++){var _=o[D],H=s[D],O=f[D],y=l[D];if(_!==Z){var N=q.interpolation,d="CUBICSPLINE"===N?"cubicSpline":"STEP"===N?"discrete":"linear";"rotation"===y.path&&("cubicSpline"===d?d="cubicSplineQuaternion":"linear"===d&&(d="quaternion"));var N=(N=_.name)||(_.name="node"+x.next()),C=[],a=(y.path,C.push(N),O.array);if(O.normalized){for(var z=G(a.constructor),b=new Float32Array(a.length),w=0,Q=a.length;w<Q;w++)b[w]=a[w]*z;a=b}for(w=0,Q=C.length;w<Q;w++){var u={name:C[w]+"."+yS[y.path],times:H.array,values:a,type:d};m.push(u)}}}var U=p.name||"animation_"+P,K=0;return m.forEach(function(U){K=Math.max(K,U.times[U.times.length-1])}),{name:U,duration:K,tracks:m}})},createNodeMesh:function(U){var o=this.json,s=this,f=o.nodes[U];return f.mesh===Z?null:s.getDependency("mesh",f.mesh).then(function(U){U=s._getNodeRef(s.meshCache,f.mesh,U);return f.weights!==Z&&U.traverse(function(U){if(U instanceof z)for(var o=0,s=f.weights.length;o<s;o++)U.morphTargetInfluences[o]=f.weights[o]}),U})},loadNode:function(_){var o,U=this.json,H=this.extensions,O=this,y=this.nameIdGenerator,N=U.nodes[_],d=N.name?O.createUniqueName(N.name):"";return o=[],(U=O._invokeOne(function(U){return U.createNodeMesh&&U.createNodeMesh(_)}))&&o.push(U),N.camera!==Z&&o.push(O.getDependency("camera",N.camera).then(function(U){return O._getNodeRef(O.cameraCache,N.camera,U)})),O._invokeAll(function(U){return U.createNodeAttachment&&U.createNodeAttachment(_)}).forEach(function(U){o.push(U)}),Promise.all(o).then(function(U){var o,s,f,l,m;if(!0===N.isBone?(o=new a).isBone=!0:o=!(1<U.length)&&1===U.length?U[0]:new a,o!==U[0])for(var D=0,t=U.length;D<t;D++)o.add(U[D]);return N.name&&(o.userData&&(o.userData.name=N.name),o.name=d),o.isBone&&!o.name&&(o.name="node"+y.next()),F(o,N),N.extensions&&h(H,o,N),N.matrix!==Z?((s=new K.Math.Matrix4).fromArray(N.matrix),f=new P,l=new P,m=new K.Math.Quaternion,s.decompose(f,m,l),o.position=f.toArray(),o.scale=l.toArray(),o.quaternion=m.toArray()):(N.translation!==Z&&(o.position=N.translation),N.rotation!==Z&&(o.quaternion=N.rotation),N.scale!==Z&&(o.scale=N.scale)),O.associations.has(o)||O.associations.set(o,{}),O.associations.get(o).nodes=_,o})},loadScene:function(U){for(var o=this.json,s=this.extensions,U=this.json.scenes[U],l=this,f=new a,m=(U.name&&(f.name=l.createUniqueName(U.name)),F(f,U),U.extensions&&h(s,f,U),U.nodes||[]),D=[],t=0,_=m.length;t<_;t++)D.push(function D(U,t,_,H){var O=_.nodes[U];return H.getDependency("node",U).then(function(U){return O.skin===Z?U:H.getDependency("skin",O.skin).then(function(U){for(var o=[],s=0,f=(t=U).joints.length;s<f;s++)o.push(H.getDependency("node",t.joints[s]));return Promise.all(o)}).then(function(D){return U.traverse(function(U){if(U instanceof z){for(var o=[],s=[],f=0,l=D.length;f<l;f++){var m=D[f];m?(o.push(m),m=new w,t.inverseBindMatrices!==Z&&m.fromArray(t.inverseBindMatrices.array,16*f),m.toArray(s,s.length)):console.warn("Joint %s could not be found.",t.joints[f])}U.skeleton=[o,s,U.matrixWorld]}}),U});var t}).then(function(U){t.add(U);var o=[];if(O.children)for(var s=O.children,f=0,l=s.length;f<l;f++){var m=s[f];o.push(D(m,U,_,H))}return Promise.all(o)})}(m[t],f,o,l));return Promise.all(D).then(function(){return l.associations=function(U){var o,s=new Map;for(o in l.associations){var f=l.associations[o];(o instanceof b||o instanceof O)&&s.set(o,f)}return U.traverse(function(U){var o=l.associations.get(U);null!=o&&s.set(U,o)}),s}(f),f})}});var T=new WeakMap,wS=function(){this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};m.assign(wS.prototype,{setDecoderPath:function(U){return this.decoderPath=U,this},setDecoderConfig:function(U){return this.decoderConfig=U,this},setWorkerLimit:function(U){return this.workerLimit=U,this},load:function(U,o,s,f){var l=this,m=l.path+U;K.Default.xhrLoad(m,function(U){U?l.decodeDracoFile(U,o).catch(f):f("Failed to load "+m)},{responseType:"arraybuffer"})},decodeDracoFile:function(U,o,s,f){f={attributeIDs:s||this.defaultAttributeIDs,attributeTypes:f||this.defaultAttributeTypes,useUniqueIDs:!!s};return this.decodeGeometry(U,f).then(o)},decodeGeometry:function(s,f){var U=JSON.stringify(f);if(T.has(s)){var o=T.get(s);if(o.key===U)return o.promise;if(0===s.byteLength)throw new Error("DRACOLoader: Unable to decode a buffer.")}var l,m=this,D=m.workerNextTaskID++,o=s.byteLength,o=m._getWorker(D,o).then(function(U){return l=U,new Promise(function(U,o){l._callbacks[D]={resolve:U,reject:o},l.postMessage({type:"decode",id:D,taskConfig:f,buffer:s},[s])})}).then(function(U){return m._createGeometry(U.geometry)});return o.catch(function(){return!0}).then(function(){l&&D&&m._releaseTask(l,D)}),T.set(s,{key:U,promise:o}),o},_createGeometry:function(U){var o=new C;U.index&&o.setIndex(new p(U.index.array,1));for(var s=0;s<U.attributes.length;s++){var f=U.attributes[s],l=f.name,m=f.array,f=f.itemSize;o.setAttribute(l,new p(m,f))}return o},_loadLibrary:function(U,f){var l=this.decoderPath+U;return new Promise(function(o,s){K.Default.xhrLoad(l,function(U){U?o(U):s("Failed to load "+l)},{responseType:f})})},preload:function(){return this._initDecoder(),this},_initDecoder:function(){var s=this;if(s.decoderPending)return s.decoderPending;var f="object"!=typeof WebAssembly||"js"===s.decoderConfig.type,U=[];return f?U.push(s._loadLibrary("draco_decoder.js","text")):(U.push(s._loadLibrary("draco_wasm_wrapper.js","text")),U.push(s._loadLibrary("draco_decoder.wasm","arraybuffer"))),s.decoderPending=Promise.all(U).then(function(U){var o=U[0],U=(f||(s.decoderConfig.wasmBinary=U[1]),function(){var s,o;function _(U,o,s,f){var l,m=f.attributeIDs,D=f.attributeTypes,t=o.GetEncodedGeometryType(s);if(t===U.TRIANGULAR_MESH)l=new U.Mesh,Q=o.DecodeBufferToMesh(s,l);else{if(t!==U.POINT_CLOUD)throw new Error("DRACOLoader: Unexpected geometry type.");l=new U.PointCloud,Q=o.DecodeBufferToPointCloud(s,l)}if(!Q.ok()||0===l.ptr)throw new Error("DRACOLoader: Decoding failed: "+Q.error_msg());var _,H,O,y,N,d,C,a,z,b,w,Q,u,K,P,p={index:null,attributes:[]};for(_ in m){var x,q,Z=self[D[_]];if(f.useUniqueIDs)q=m[_],x=o.GetAttributeByUniqueId(l,q);else{if(-1===(q=o.GetAttributeId(l,U[m[_]])))continue;x=o.GetAttribute(l,q)}p.attributes.push((H=U,O=o,y=l,N=_,Z=Z,w=b=z=a=C=void 0,C=(d=x).num_components(),a=y.num_points()*C,z=a*Z.BYTES_PER_ELEMENT,b=function(U,o){switch(o){case Float32Array:return U.DT_FLOAT32;case Int8Array:return U.DT_INT8;case Int16Array:return U.DT_INT16;case Int32Array:return U.DT_INT32;case Uint8Array:return U.DT_UINT8;case Uint16Array:return U.DT_UINT16;case Uint32Array:return U.DT_UINT32}}(H,Z),w=H._malloc(z),O.GetAttributeDataArrayForAllPoints(y,d,b,z,w),O=new Z(H.HEAPF32.buffer,w,a).slice(),H._free(w),{name:N,array:O,itemSize:C}))}return t===U.TRIANGULAR_MESH&&(p.index=(s=U,Q=o,u=3*(t=l).num_faces(),K=4*u,P=s._malloc(K),Q.GetTrianglesUInt32Array(t,K,P),Q=new Uint32Array(s.HEAPF32.buffer,P,u).slice(),s._free(P),{array:Q,itemSize:1})),U.destroy(l),p}onmessage=function(U){var m=U.data;switch(m.type){case"init":s=m.decoderConfig,o=new Promise(function(o){s.onModuleLoaded=function(U){o({draco:U})},DracoDecoderModule(s)});break;case"decode":var D=m.buffer,t=m.taskConfig;o.then(function(U){var U=U.draco,o=new U.Decoder,s=new U.DecoderBuffer;s.Init(new Int8Array(D),D.byteLength);try{var f=_(U,o,s,t),l=f.attributes.map(function(U){return U.array.buffer});f.index&&l.push(f.index.array.buffer),self.postMessage({type:"decode",id:m.id,geometry:f},l)}catch(U){console.error(U),self.postMessage({type:"error",id:m.id,error:U.message})}finally{U.destroy(s),U.destroy(o)}})}}}.toString()),o=["/* draco decoder */",o,"","/* worker */",U.substring(U.indexOf("{")+1,U.lastIndexOf("}"))].join("\n");s.workerSourceURL=URL.createObjectURL(new Blob([o]))}),s.decoderPending},_getWorker:function(U,o){var f=this;return f._initDecoder().then(function(){f.workerPool.length<f.workerLimit?((s=new Worker(f.workerSourceURL))._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:f.decoderConfig}),s.onmessage=function(U){var o=U.data;switch(o.type){case"decode":s._callbacks[o.id].resolve(o);break;case"error":s._callbacks[o.id].reject(o);break;default:console.error('DRACOLoader: Unexpected message, "'+o.type+'"')}},f.workerPool.push(s)):f.workerPool.sort(function(U,o){return U._taskLoad>o._taskLoad?-1:1});var s=f.workerPool[f.workerPool.length-1];return s._taskCosts[U]=o,s._taskLoad+=o,s})},_releaseTask:function(U,o){U._taskLoad-=U._taskCosts[o],delete U._callbacks[o],delete U._taskCosts[o]},debug:function(){},dispose:function(){for(var U=0;U<this.workerPool.length;++U)this.workerPool[U].terminate();return this.workerPool.length=0,this}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);